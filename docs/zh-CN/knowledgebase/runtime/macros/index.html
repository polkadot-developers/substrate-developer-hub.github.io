<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>宏 · Substrate Developer Hub</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&gt; **Update:** As of January 2021, FRAME based pallets have upgraded their use of macros. Refer to [this guide](https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#upgrade-guidelines) to learn about migrating a v1 pallet to v2."/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="宏 · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="&gt; **Update:** As of January 2021, FRAME based pallets have upgraded their use of macros. Refer to [this guide](https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#upgrade-guidelines) to learn about migrating a v1 pallet to v2."/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script><script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/past-seminars.js"></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class="siteNavGroupActive"><a href="/docs/zh-CN/" target="_self">知识库</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">进阶菜谱</a></li><li class=""><a href="https://substrate.dev/substrate-how-to-guides/" target="_self">How-to Guides</a></li><li class=""><a href="https://substrate.dev/rustdocs/" target="_self">Reference</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>简体中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/knowledgebase/runtime/macros">English</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">协助翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Runtime 开发</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">开始<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/">总览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/architecture">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/">安装</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/windows-users">在 Windows 系统开始</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/getting-started/glossary">词汇表</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Substrate Key Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/">Runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/account-abstractions">账户摘要</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/tx-pool">交易池</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/session-keys">会话密钥</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/weight">Transaction Weights</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/learn-substrate/off-chain-features">链下功能</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Runtime 开发<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/pallets">Pallets</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/frame">FRAME</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/macros">宏</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/metadata">元数据</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/storage">Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/origin">来源 (Origin)</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/execution">Execution</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/events">Events</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/errors">Errors</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/fees">Transaction Fees and Weights</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/benchmarking">Benchmarking</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/debugging">调试</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/tests">Tests</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/randomness">链上随机生成</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/runtime/upgrades">Upgrades</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">智能合约<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/">总览</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/contracts-pallet">合约 (Contracts) 模块</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/evm-pallet">EVM 模块</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/smart-contracts/faq">F.A.Q.</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">整合<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/polkadot-js">Polkadot-JS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/libraries">客户端库</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/chain-spec">链规范</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/subkey">Subkey</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/memory-profiling">内存分析</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/integrate/try-runtime">Try Runtime</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">进阶<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/account-info">Account Information</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/codec">SCALE 编解码器</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/consensus">共识机制</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/block-import">区块导入过程</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/executor">Runtime Executor</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/cryptography">密码学</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/storage">存储</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/ss58-address-format">SS58 地址格式</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/knowledgebase/advanced/no-hash-collections">Hash Collections</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">贡献<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/contribute/help-translate">协助翻译</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">宏</h1></header><article><div><span><blockquote>
<p><strong>Update:</strong> As of January 2021, FRAME based pallets have upgraded their use of macros. Refer to <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#upgrade-guidelines">this guide</a> to learn about migrating a v1 pallet to v2.</p>
</blockquote>
<p>Substrate uses <a href="https://doc.rust-lang.org/book/ch19-06-macros.html">Rust macros</a> to aggregate the logic derived from pallets that are implemented for a runtime. These runtime macros allow developers to focus on runtime logic rather than encoding and decoding on-chain variables or writing extensive blocks of code to achieve <a href="index#core-primitives">basic blockchain fundamentals</a>. This offloads a lot of the heavy lifting from blockchain development efforts and removes the need to duplicate code.</p>
<p>The purpose of this article is to give a basic overview of Rust macros and explain the Substrate macros that runtime engineers most frequently use.</p>
<h2><a class="anchor" aria-hidden="true" id="macro-basics"></a><a href="#macro-basics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Macro Basics</h2>
<p>Put simply, macros are lines of code that write code. They provide the ability to abstract things out without needing to declare complex data structures explicitly. There are four kinds of macro in Rust:</p>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch19-06-macros.html#declarative-macros-with-macro_rules-for-general-metaprogramming">declarative macros</a> (most widely used)</li>
<li><a href="https://doc.rust-lang.org/book/ch19-06-macros.html#how-to-write-a-custom-derive-macro">custom derive</a> (a type of procedural macro)</li>
<li><a href="https://doc.rust-lang.org/book/ch19-06-macros.html#attribute-like-macros">attribute-like macros</a> (a type of procedural macro)</li>
<li><a href="https://doc.rust-lang.org/book/ch19-06-macros.html#function-like-macros">function-like macros</a> (a type of procedural macro)</li>
</ul>
<p>Most Substrate runtime macros are defined using either <strong>declarative macros</strong> or <strong>function-like macros</strong>, with a recent adoption of <strong>attribute-like macros</strong> in FRAME v2 pallets.</p>
<blockquote>
<p><strong>Tips to learn more about Substrate runtime macros</strong>:</p>
<ul>
<li>read the <a href="https://substrate.dev/rustdocs/latest/frame_support/index.html#macros">documentation</a> on commonly used macros in FRAME</li>
<li>use <a href="https://github.com/dtolnay/cargo-expand"><code>cargo expand</code></a> to review a macro's expanded code and understand what's happening under the hood</li>
<li>read more on <a href="https://danielkeep.github.io/tlborm/book/pim-README.html">macro rules of expression pattern matching</a></li>
</ul>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="substrate-runtime-macros"></a><a href="#substrate-runtime-macros" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Substrate Runtime Macros</h2>
<p>The following section is a comprehensive explanation of the macros that runtime engineers most frequently encounter. Developers who want to know about the implementation details are encouraged to follow the links in &quot;Docs and Notes&quot; sub-sections to better understand how each macro expands.</p>
<p>Substrate Primitives and FRAME both rely on a collection of various types of macros. The following sections will go over each in more detail. Here's a general overview of Substrate macros:</p>
<p><strong>Macros in the FRAME <a href="./frame#support-library">Support Library</a>:</strong></p>
<ul>
<li>in <code>frame_support</code>:
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/index.html#macros">function-like</a> macros</li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/index.html#derives">derive</a> macros</li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/index.html#attributes">attribute</a> macros</li>
</ul></li>
</ul>
<p><strong>Macros in the Substrate <a href="./frame#system-library">System Library</a>:</strong></p>
<ul>
<li>in <code>sp_core</code>:
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/sp_core/index.html#macros">function-like macros</a> macros</li>
<li><a href="https://substrate.dev/rustdocs/latest/sp_core/index.html#derives">derive <code>RuntimeDebug</code></a> macro</li>
</ul></li>
<li>in <code>sp_runtime</code>:
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/sp_runtime/index.html#macros">function-like</a> macros</li>
<li><a href="https://substrate.dev/rustdocs/latest/sp_runtime/index.html#derives">derive</a> macros</li>
</ul></li>
<li>in <code>serde</code>: <a href="https://substrate.dev/rustdocs/latest/sp_runtime/index.html#derives">function-like</a> macros</li>
<li>in <code>sp_api</code>: <a href="https://substrate.dev/rustdocs/latest/sp_api/index.html#macros">function-like</a> macros</li>
<li>in <code>sp_std</code>: <a href="https://substrate.dev/rustdocs/latest/sp_std/index.html#macros">function-like</a> macros</li>
<li>in <code>sp_version</code>: <a href="https://substrate.dev/rustdocs/latest/sp_version/index.html#macros">function-like</a> macros</li>
</ul>
<blockquote>
<p><strong>Note</strong>: refer to <code>#Substrate dependencies</code> in the <code>Cargo.toml</code> file of the <a href="https://github.com/substrate-developer-hub/substrate-node-template/blob/master/runtime/Cargo.toml#L21">node template runtime</a> to see where these are put to use.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="overview-of-frame-versioning"></a><a href="#overview-of-frame-versioning" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview of FRAME Versioning</h2>
<p>Here's a comparative overview of FRAME v1 and v2:</p>
<ul>
<li>v1 relies on runtime engineers to write more code to declare traits and types in a way that is closer to learning a DSL (Domain-specific Language). The way macro inputs are structured can make it more difficult to understand what the macro is doing and how to use it.</li>
<li>v2 is more heavily based on Rust idioms to define types and uses FRAME crates by writing code within the constaints of the macro being used. If all macros were removed, the pallet would still compile as all macro inputs are correct Rust syntax, making it easier to understand where errors are coming from.</li>
</ul>
<blockquote>
<p>Overall, the big improvements that v2 brings is better developer experience by removing the need to write extra code. The main difference is how concepts are declared to use the <a href="https://substrate.dev/docs/en/knowledgebase/runtime/frame">crates that make up FRAME</a>. Both versions are just different ways to express the logic and types declared inside a pallet. Yet, both serve the same purpose — which is to aggregate the logic that defines how the runtime is implemented.</p>
</blockquote>
<p><strong>Things to note:</strong></p>
<ul>
<li><p>v2 is backwards compatible with v1, meaning that any pallet declared using v1 can be declared using v2 without too much difficulty (see <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#upgrade-guidelines">upgrade guidelines</a> for more details). However, v1 will cease getting improvement features.</p></li>
<li><p>Using instantiable pallets with v2 requires a different approach than for v1. See the guide <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#example-for-pallet-with-instance">here</a> for more information on how that works.</p></li>
<li><p>In v2, items are defined inside a module, therefore <code>pub(super)</code> is used to make those items private but accessible to the <code>super</code> namespace (i.e. the crate root namespace).</p></li>
<li><p><code>RawEvent</code> is no longer used in v2, all instances of events are declared as <code>Event</code>.</p></li>
<li><p>Use <a href="https://github.com/ascjones/subsee">subsee</a> as a tool to query metadata.</p></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="frame-v1-declarative-macros"></a><a href="#frame-v1-declarative-macros" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FRAME v1 Declarative Macros</h2>
<h3><a class="anchor" aria-hidden="true" id="decl_storage"></a><a href="#decl_storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>decl_storage!</h3>
<p><strong>何时使用</strong></p>
<p>To define storage items in a FRAME pallet. A storage item definition includes:</p>
<ul>
<li><p>its data type, being one of:</p>
<ul>
<li>for <code>StorageValue</code>: <code>rust-type</code></li>
<li>for <code>StorageMap</code>: <code>map hasher($hasher) rust_type =&gt; rust_type</code></li>
<li>for <code>StorageDoubleMap</code>: <code>doublemap hasher($hasher) rust_type, hasher($hasher) rust_type =&gt; rust_type</code></li>
<li>for <code>StorageNMap</code>: <code>nmap hasher($hasher1) rust_type, hasher($hasher2) rust_type, /* ... */ hasher($hasherN) rust_type =&gt; rust_type</code></li>
</ul></li>
<li><p>its getter function,</p></li>
<li><p>its key types and their hashing methods (if a map, double-map or n-map),</p></li>
<li><p>the name of the storage,</p></li>
<li><p>its default value</p></li>
</ul>
<p>These storage values can be initialized in its genesis block via an <code>add_extra_genesis</code> block afterwards.</p>
<pre><code class="hljs css language-rust"><span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span>
  <span class="token keyword">trait</span> <span class="token class-name">Storage</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Config</span><span class="token operator">></span> <span class="token keyword">as</span> <span class="token class-name">MyModule</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  add_extra_genesis <span class="token punctuation">{</span>
    <span class="token function">build</span> <span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>config<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
      <span class="token comment">//...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>有何作用</strong></p>
<p>This macro declares and implements the <code>Store</code> trait to set up the pallet to have storage space, and implements getters on the <code>Module</code> struct defined by <code>decl_module!</code>.</p>
<p>It takes a succinct statement of:</p>
<pre><code class="hljs">#vis #name <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">fn</span> #getter<span class="token punctuation">)</span> <span class="token function">config</span><span class="token punctuation">(</span>#field_name<span class="token punctuation">)</span> <span class="token function">build</span><span class="token punctuation">(</span>#closure<span class="token punctuation">)</span><span class="token punctuation">:</span> #<span class="token keyword">type</span> <span class="token operator">=</span> #default<span class="token punctuation">;</span>
</code></pre>
<p>Replacing it with a new struct type defined by <code>#name</code> and have it implement the data type storage trait.</p>
<p><strong>Docs and Notes</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.decl_storage.html">API 文档</a></li>
<li><code>Store</code> trait is declared with each storage name, thus becoming an associated type inside the trait.</li>
<li><code>Module</code> implementation contains the getter function and metadata of each storage item.</li>
<li>Each of the storage items becomes a struct.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="decl_event"></a><a href="#decl_event" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>decl_event!</h3>
<p><strong>何时使用</strong></p>
<p>To define the events that a pallet emits.</p>
<p><strong>有何作用</strong></p>
<p>This macro defines pallet events by implementing the <code>Event</code> enum type, with each event type in the macro being an enum variant inside <code>Event</code>.</p>
<p><strong>Docs and Notes</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.decl_event.html">API 文档</a></li>
<li><code>Event</code> or <code>Event&lt;T&gt;</code> type is defined, assigned to <code>RawEvent</code>.</li>
<li><code>RawEvent&lt;...all generic types used&gt;</code> enum type is defined with all events specified in the macro as its enum variants.</li>
<li>The macro implements various helper traits for<code>RawEvent</code>, including data encoding/decoding, <code>core::cmp::PartialEq</code>, <code>core::cmp::Clone</code>, and <code>core::fmt::Debug</code>.</li>
<li><code>RawEvent&lt;...&gt;</code> implements <code>metadata()</code> function to retrieve meta-data for events emitted in the pallet.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="decl_error"></a><a href="#decl_error" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>decl_error!</h3>
<p><strong>何时使用</strong></p>
<p>To define error types which a pallet may return in its dispatchable functions. Dispatchable functions return <code>DispatchResult</code>, with either an <code>Ok(())</code>, or <code>DispatchError</code> containing custom errors defined in this macro.</p>
<p><strong>有何作用</strong></p>
<p>This macro defines the <code>Error&lt;T: Config&gt;</code> type, and implements helper methods for mapping each error type to a sequential error code and corresponding string.</p>
<p>One key feature is that the macro automatically implements the <code>From&lt;Error&lt;T&gt;&gt;</code> trait for <code>DispatchError</code>. Therefore, <code>DispatchError</code> returns the proper module index, error code, error string for a particular error type, and the documentation provided on top of each error as metadata.</p>
<p><strong>Docs and Notes</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.decl_error.html">API 文档</a></li>
<li><code>Error&lt;T: Config&gt;</code> enum type is filled with enum variants specified in the macro.</li>
<li><code>Error</code> implements various helper functions, and maps each error to a sequential error code and an error string.</li>
<li><code>Error</code> type implementation contains a <code>fn metadata()</code> function.</li>
<li><code>Error</code> implements <code>From&lt;Error&lt;T&gt;&gt;</code> for <code>DispatchError</code>, so the error type can be returned in dispatchable functions.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="decl_module"></a><a href="#decl_module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>decl_module!</h3>
<p><strong>何时使用</strong></p>
<p>To define dispatchable functions in a pallet.</p>
<p><strong>有何作用</strong></p>
<p>The macro declares a <code>Module</code> struct and <code>Call</code> enum type for the containing pallet. It combines the necessary logics using user-defined dispatchable calls into the two types. In addition to various helper traits implemented for <code>Module</code> and <code>Call</code>, e.g. <code>Copy</code>, <code>StructuralEq</code>, <code>Debug</code>, the macro also inserts lifecycle trait implementations for <code>Module</code>, e.g. <code>frame_support::traits::OnInitialize</code>, <code>frame_support::traits::OnFinalize</code>, <code>frame_support::traits::OnRuntimeUpgrade</code>, and <code>frame_support::traits::OffchainWorker</code>.</p>
<p><strong>Docs and Notes</strong></p>
<ul>
<li><p><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.decl_module.html">API 文档</a></p></li>
<li><p>This macro declares a <code>Module&lt;T&gt;</code> struct and a <code>Call&lt;T&gt;</code> enum which implements the dispatch logic.</p></li>
<li><p>Helper traits are automatically implemented for <code>Module</code> struct, such as <code>core::cmp::Eq</code>, <code>core::clone::Clone</code>, etc.</p></li>
<li><p><code>Module</code> implements various lifecycle traits, such as</p>
<ul>
<li><code>frame_support::traits::OnInitialize</code>: callback when a block is initialized,</li>
<li><code>frame_support::traits::OnRuntimeUpgrade</code>: callback when a chain is undergoing a runtime upgrade,</li>
<li><code>frame_support::traits::OnFinalize</code>: callback when a block is finalized, and</li>
<li><code>frame_support::traits::OffchainWorker</code>: entrance of an offchain worker upon a block is finalized.</li>
</ul></li>
<li><p><code>Call&lt;T: Config&gt;</code> implements <code>frame_support::dispatch::GetDispatchInfo</code> and <code>frame_support::traits::UnfilteredDispatchable</code> traits that contain the core logic for dispatching calls.</p></li>
<li><p><code>Module&lt;T&gt;</code> implements <code>frame_support::dispatch::Callable&lt;T&gt;</code> trait with its associated type <code>Call</code> assigned to the <code>Call</code> enum.</p></li>
<li><p>Each dispatchable function is prepended with internal tracing logic for keeping track of the node activities. Developers can set whether to trace for a dispatchable function by specifying its interest level.</p></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="frame-v2-macros-and-attributes"></a><a href="#frame-v2-macros-and-attributes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FRAME v2 Macros and Attributes</h2>
<p>This sections covers the updates brought by FRAME v2. Refer to the <a href="/docs/zh-CN/knowledgebase/runtime/pallets">structure of a pallet</a> for more context.</p>
<h3><a class="anchor" aria-hidden="true" id="frame_supportpallet"></a><a href="#frame_supportpallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[frame_support::pallet]</h3>
<p><strong>何时使用</strong></p>
<p>Required to declare a pallet consisting of a set of types, functions, and trait implementations that will later be aggregated by <code>construct_runtime</code> to build to runtime.</p>
<p><strong>有何作用</strong></p>
<p>This is the <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html">attribute macro</a> that allows the pallet to be used in <code>construct_runtime!</code>. This macro is made up of the various attributes that will be used to identify the specific items the pallet requires.</p>
<p><strong>Note:</strong> similar to a derive macro, this macro only expands types and trait implementations by reading the input and its input is <em>almost</em> never touched. The only exception where this macro modifies its input (contrary to a derive macro) is:</p>
<ul>
<li><strong>when a generic is replaced with a type</strong>. For example, in <code>pallet::pallet</code> the inner types of the item in <code>pub struct Pallet&lt;..&gt;(_)</code> is replaced by <code>PhantomData</code> and in <code>pallet::storage</code>, the first generic <code>_</code> is replaced with a type that implements the <code>StorageInstance</code> trait.</li>
<li><strong>some item is changed</strong>. For example, when <code>pallet::type_value</code> changes the function item into a struct and trait implementation.</li>
<li><strong>some docs are added when none are provided by the user.</strong> For example, if no documentation is provided the macro <code>pallet::pallet</code> will modify the input to add documentation above the item <code>struct Pallet&lt;T&gt;(_);</code>.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palletconfig"></a><a href="#palletconfig" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::config]</h3>
<p><strong>何时使用</strong></p>
<p>Required to define the pallet's generics.</p>
<p><strong>What it Does</strong></p>
<p>Provides constants that are part of the <a href="https://substrate.dev/rustdocs/latest/frame_system/pallet/trait.Config.html"><code>Config</code> trait</a> and gives information about external tools to use for the runtime.</p>
<p><strong>文档</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#config-trait-palletconfig-mandatory">Config trait</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palletconstant"></a><a href="#palletconstant" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::constant]</h3>
<p><strong>何时使用</strong></p>
<p>To pass values of associated types to metadata, which allows the value of the type to be used by external tools and third parties. Note that this attribute is only usable from inside a <code>#[pallet::config]</code> item.</p>
<p><strong>What it Does</strong></p>
<p>Provides the <code>Config</code> trait with the types and attributes it needs for the runtime and generates associated metadata.</p>
<p>Adding the <code>#[pallet::constant]</code> attribute will result in the macro adding to the constant metadata, including: the constant's name; the name of the associated type; the constant's value; and the value returned by <code>Get::get()</code>.</p>
<p>For example, we can use <code>#[pallet::constant]</code> to put <code>type MyGetParam</code> in metadata:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[pallet::config]</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Config</span><span class="token punctuation">:</span> <span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">Config</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[pallet::constant]</span> <span class="token comment">// puts attributes in metadata</span>
    <span class="token keyword">type</span> <span class="token class-name">MyGetParam</span><span class="token punctuation">:</span> <span class="token class-name">Get</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>文档</strong></p>
<ul>
<li>See use in the context of <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#config-trait-palletconfig-mandatory">#[pallet::config]</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palletextra_constants"></a><a href="#palletextra_constants" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::extra_constants]</h3>
<p><strong>何时使用</strong></p>
<p>Optionally, for additional constants one may want to pass to metadata.</p>
<p><strong>What it Does</strong></p>
<p>It allows to define some additional constants to put into metadata. For example, you could declare a function that returns a value that will be generated to metadata:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[pallet::extra_constants]</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Config</span><span class="token operator">></span> <span class="token class-name">Pallet</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">//Example function using extra_constants</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">example_extra_constants</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u128</span> <span class="token punctuation">{</span> 4u128 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>文档</strong></p>
<ul>
<li>See <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#extra-constants-palletextra_constants-optional">documentation</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palletpallet"></a><a href="#palletpallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::pallet]</h3>
<p><strong>何时使用</strong></p>
<p>Required to declare the pallet struct place holder, to be later used by <code>construct_runtime</code>.</p>
<p><strong>What it Does</strong></p>
<p>Generates the <code>Store</code> trait if the attribute is provided, which contains an associated type for each storage item. It takes the form of a more explicit Rust struct module and can be written as <code>pub struct Pallet&lt;T&gt;(_);</code>, with the appropriate <code>PhantomData</code> replacing <code>_</code> to make it generic.</p>
<p>This is an example of its definition:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[pallet::pallet]</span>
<span class="token attribute attr-name">#[pallet::generate_store(pub(super) trait Store)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Pallet</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token class-name">PhantomData</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>文档</strong></p>
<ul>
<li>See the <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#macro-expansion-1">macro expansion</a> added to the <code>struct Pallet&lt;T&gt;</code> definition</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="pallethooks"></a><a href="#pallethooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::hooks]</h3>
<p><strong>何时使用</strong></p>
<p>Required for declaring pallet hooks.</p>
<p><strong>What it Does</strong></p>
<p><a href="https://substrate.dev/rustdocs/latest/frame_support/traits/trait.Hooks.html#provided-methods"><code>Hooks</code></a> are made available by using the <code>Hooks</code> trait.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[pallet::hooks]</span>
imple<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Config</span><span class="token operator">></span> <span class="token class-name">Hooks</span><span class="token operator">&lt;</span><span class="token class-name">BlockNumberFor</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">>></span> <span class="token keyword">for</span> <span class="token class-name">Pallet</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">// Hooks functions and logic goes here.</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>文档</strong></p>
<ul>
<li>See the <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#hooks-pallethooks-mandatory">documentation</a></li>
<li>See the <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#macro-expansion-2">macro expansion</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palletcall"></a><a href="#palletcall" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::call]</h3>
<p><strong>何时使用</strong></p>
<p>Required, to implement a pallet's dispatchables. Each dispatchable must:</p>
<ul>
<li>define a weight with the <code>#[pallet::weight($expr)]</code> attribute</li>
<li>have its first argument as <code>origin: OriginFor&lt;T&gt;</code>,</li>
<li>use compact encoding for argument using #[pallet::compact]</li>
<li>return <code>DispatchResultWithPostInfo</code> or <code>DispatchResult</code></li>
</ul>
<p><strong>What it Does</strong></p>
<p><a href="https://substrate.dev/docs/en/knowledgebase/learn-substrate/extrinsics">Extrinsics</a> can use calls to trigger specific logic. Calls can also be used in on-chain governance, demonstrated by the democracy pallet where calls can be voted on. <code>#[pallet::call]</code> allows to create dispatchable functions which will generate associated items from the <code>impl</code> code blocks. In other words, it aggregates all dispatchable logic using the [<code>Call</code> enum (<a href="https://substrate.dev/rustdocs/latest/frame_system/pallet/enum.Call.html">https://substrate.dev/rustdocs/latest/frame_system/pallet/enum.Call.html</a>) which will aggregate all dispatchable calls into a single runtime call.</p>
<p><strong>文档</strong></p>
<ul>
<li>See the <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#call-palletcall-mandatory">documentation</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palleterror"></a><a href="#palleterror" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::error]</h3>
<p><strong>何时使用</strong></p>
<p>Optionally, to define error types to be used in dispatchables.</p>
<p><strong>What it Does</strong></p>
<p>Puts error variants documentation into metadata.</p>
<p><strong>文档</strong></p>
<ul>
<li>See <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#error-palleterror-optional">documentation</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palletevents"></a><a href="#palletevents" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::events]</h3>
<p><strong>何时使用</strong></p>
<p>Optionally, to define a pallet's event types.</p>
<p><strong>What it Does</strong></p>
<p>It is similar to errors but it can holds more information. They generate the metadata of the event and add_derive. It uses the <code>#[pallet::metadata(..)]</code> attribute to define what metadata to put from the events.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[pallet::event]</span>
<span class="token attribute attr-name">#[pallet::metadata(u32 = <span class="token string">"SpecialU32"</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Event</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Config</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token class-name">Proposed</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>文档</strong></p>
<ul>
<li>See <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#event-palletevent-optional">documentation</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="palletstorage"></a><a href="#palletstorage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>#[pallet::storage]</h3>
<p><strong>何时使用</strong></p>
<p>Optionally, as it can be used multiple times.</p>
<p><strong>What it Does</strong></p>
<p>To define some abstract storage inside runtime storage.</p>
<p><strong>Note:</strong> this changes how storage is declared compared to v1. Here, <code>[pallet::storage]</code> is using a Rust-like HashMap to do storage, except it takes a Key, Value, Hasher, Prefix, QueryKind and an OnEmpty parameter. The prefix generic defines the place where the storage will store its <code>(key, value)</code> pairs (i.e. the trie) and defines the pallet and storage Prefix like such: <code>concat(twox_128(pallet_prefix), towx_128(storage_prefix))</code>, replacing <code>_</code> with the generated prefix implementations of the pallet and storage names.</p>
<p><strong>文档</strong></p>
<ul>
<li>See <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#storage-palletstorage-optional">macro documentation</a></li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/pallet_prelude/struct.StorageMap.html#implementations"><code>StorageMap</code> implementation</a></li>
<li><a href="https://doc.rust-lang.org/book/ch08-03-hash-maps.html">Rust HashMap syntax</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="other-attributes"></a><a href="#other-attributes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other Attributes</h3>
<p>Other FRAME v2 macro attributes include:</p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#genesis-config-palletgenesis_config-optional">#[pallet::genesis_config]</a></li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#type-value-pallettype_value-optional">#[pallet::type_value]</a></li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#genesis-build-palletgenesis_build-optional">#[pallet::genesis_build]</a></li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#inherent-palletinherent-optional">#[pallet::inherent]</a></li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#validate-unsigned-palletvalidate_unsigned-optional">#[pallet::validate_unsigned]</a></li>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/attr.pallet.html#origin-palletorigin-optional">#[pallet::origin]</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="additional-frame-macros"></a><a href="#additional-frame-macros" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Additional FRAME Macros</h2>
<h3><a class="anchor" aria-hidden="true" id="construct_runtime"></a><a href="#construct_runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>construct_runtime!</h3>
<p><strong>何时使用</strong></p>
<p>To construct Substrate runtime and integrating various pallets into the runtime.</p>
<p><strong>有何作用</strong></p>
<p>The macro declares and implements various struct and enum, e.g.<code>Runtime</code>, <code>Event</code>, <code>Origin</code>, <code>Call</code>, <code>GenesisConfig</code> etc, and implements various helper traits for these struct types. The macro also adds logics of mapping different events and dispatchable calls from the overarching runtime back to a particular pallet.</p>
<p><strong>Docs and Notes</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.construct_runtime.html">API 文档</a></li>
<li><code>Runtime</code> struct type is defined to represent the Substrate runtime.</li>
<li><code>Event</code> enum type is defined with variants of all pallets that emit events, with helper traits and encoding/decoding traits implemented for the enum. Various conversion traits <code>Event</code> also implements <code>TryInto&lt;pallets::Event&lt;Runtime&gt;&gt;</code> trait to extract the event out from the enum type.</li>
<li><code>Origin</code> enum type is defined with helper traits, e.g. <code>PartialEq</code>, <code>Clone</code>, <code>Debug</code> implemented. This enum type defines who calls an extrinsic: <code>NONE</code>, <code>ROOT</code>, or signed by a particular account. These three primitive origins are defined by the FRAME System module, but optional FRAME pallets may also define origins.</li>
<li><code>Call</code> enum type is defined with all integrated pallets as variants. It contains the data and metadata of each of the integrated pallets, and redirects calls to the specific pallet via implementing <code>frame_support::traits::UnfilteredDispatchable</code> trait.</li>
<li><code>GenesisConfig</code> struct type is defined and implements <code>sp_runtime::BuildStorage</code> trait for building up the storage genesis config.</li>
<li>The macro adopts the <code>frame_support::unsigned::ValidateUnsigned</code> trait implementation from each pallet. If no <code>ValidateUnsigned</code> trait is implemented in any included pallets, all unsigned transactions will be rejected.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="parameter_types"></a><a href="#parameter_types" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>parameter_types!</h3>
<p><strong>何时使用</strong></p>
<p>To declare parameter types to be assigned to pallet configurable trait associated types during runtime construction.</p>
<p><strong>有何作用</strong></p>
<p>The macro replaces each parameter specified into a struct type with a <code>get()</code> function returning its specified value. Each parameter struct type also implements a <code>frame_support::traits::Get&lt;I&gt;</code> trait to convert the type to its specified value.</p>
<p><strong>文档</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.parameter_types.html">API 文档</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="impl_outer_origin"></a><a href="#impl_outer_origin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>impl_outer_origin!</h3>
<p><strong>何时使用</strong></p>
<p>To construct an <code>Origin</code> struct type for a runtime. This macro is typically called automatically by the <code>construct_runtime!</code> macro, but developers may call this macro directly to construct a mock runtime for testing that has a less complex structure than an actual runtime.</p>
<p>Each extrinsic call has an <code>Origin</code> type parameter passed, signaling if the call is made from <code>NONE</code>, <code>ROOT</code>, or a particular account.</p>
<p><strong>有何作用</strong></p>
<p>This macro creates an <code>Origin</code> struct type, and implements various helper traits for the type.</p>
<p><strong>文档</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.impl_outer_origin.html">API 文档</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="impl_outer_event"></a><a href="#impl_outer_event" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>impl_outer_event!</h3>
<p><strong>何时使用</strong></p>
<p>To construct an <code>Event</code> struct type for a runtime. This macro is typically called automatically by the <code>construct_runtime!</code> macro. However, developers may call this macro directly to construct an <code>Event</code> enum selecting the specific pallet events they want to listen for. This is useful when constructing a mock runtime for testing.</p>
<p><strong>有何作用</strong></p>
<p>This macro creates an event enum type, implements various helper traits on <code>Event</code> type, including <code>core::clone::Clone</code>, <code>core::marker::StructuralPartialEq</code>, <code>core::fmt::Debug</code>, data encoding/decoding traits etc. Finally, the macro implements only the specifying pallet events for the runtime.</p>
<p><strong>文档</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.impl_outer_event.html">API 文档</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="impl_outer_dispatch"></a><a href="#impl_outer_dispatch" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>impl_outer_dispatch!</h3>
<p><strong>何时使用</strong></p>
<p>To implement a meta-dispatch module to dispatch to other dispatchers. This macro is typically called automatically by the <code>construct_runtime!</code> macro. However, developers may call this macro directly to construct a <code>Call</code> enum selecting the specific pallet that it dispatches. This is useful when constructing a mock runtime for testing.</p>
<p><strong>有何作用</strong></p>
<p>This macro creates a <code>Call</code> enum type, implements various helper traits on <code>Event</code> type, including <code>Clone</code>, <code>PartialEq</code>, <code>RuntimeDebug</code> etc. Finally, the macro implements <code>GetDispatchInfo</code>, <code>GetCallMetadata</code>, <code>IsSubType</code> traits for the <code>Call</code> enum.</p>
<p><strong>文档</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/frame_support/macro.impl_outer_dispatch.html">API 文档</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="substrate-system-library-macros"></a><a href="#substrate-system-library-macros" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Substrate System Library Macros</h2>
<h3><a class="anchor" aria-hidden="true" id="impl_runtime_apis"></a><a href="#impl_runtime_apis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>impl_runtime_apis!</h3>
<p><strong>何时使用</strong></p>
<p>This macro generates the API implementations for the client side through the <code>RuntimeApi</code> and <code>RuntimeApiImpl</code> struct type.</p>
<p><strong>有何作用</strong></p>
<p>The macro defines the <code>RuntimeApi</code> and <code>RuntimeApiImpl</code> exposed to the Substrate node client. It provides implementation details of the RuntimeApiImpl based on the setup and appended user specified implementation in the <code>RuntimeApiImpl</code>.</p>
<p><strong>Docs and Notes</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/sp_api/macro.impl_runtime_apis.html">API 文档</a></li>
<li><code>RuntimeApi</code> and <code>RuntimeApiImpl</code> structs are declared. The macro also implements various helper traits for <code>RuntimeApiImpl</code>.</li>
<li>What developers define within <code>impl_runtime_apis!</code> macro are appended to the end of <code>RuntimeApiImpl</code> implementation.</li>
<li>To expose version information about the runtime, a constant <code>RUNTIME_API_VERSIONS</code> is defined. containing the runtime core <code>ID</code>/<code>VERSION</code>, metadata <code>ID</code>/<code>VERSION</code>, SessionKeys <code>ID</code>/<code>VERSION</code>, etc.</li>
<li>A public module <code>api</code> is defined with a <code>dispatch()</code> function implemented deciding how various strings are mapped to metadata or chain lifecycle calls.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="app_crypto"></a><a href="#app_crypto" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>app_crypto!</h3>
<p><strong>何时使用</strong></p>
<p>To specify cryptographic key pairs and its signature algorithm that are to be managed by a pallet.</p>
<p><strong>有何作用</strong></p>
<p>The macro declares three struct types, <code>Public</code>, <code>Signature</code>, and <code>Pair</code>. Aside from having various helper traits implemented for these three types, <code>Public</code> type is implemented to generating keypairs, signing and verifying signature, <code>Signature</code> type to hold the signature property given the signature chosen to be used (e.g. SR25519, ED25519 etc), and <code>Pair</code> type to generate a public-private key pair from a seed.</p>
<p><strong>Docs and Notes</strong></p>
<ul>
<li><a href="https://substrate.dev/rustdocs/latest/sp_application_crypto/macro.app_crypto.html">API 文档</a></li>
<li><code>Public</code> struct type is declared, and implements <code>sp_application_crypto::AppKey</code> trait defining the public key type, and <code>sp_application_crypto::RuntimeAppPublic</code> trait for generating keypairs, signing, and verifying signatures.</li>
<li><code>Signature</code> struct type is declared, and implements <code>core::hash::Hash</code> trait on how the data with this signature type is hashed.</li>
<li><code>Pair</code> struct type is declared to wrap over the crypto pair. This type implements <code>sp_application_crypto::Pair</code> and <code>sp_application_crypto::AppKey</code> traits determining how it generates public-private key pairs from a phrase or seed.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="参考文档"></a><a href="#参考文档" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参考文档</h2>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch19-06-macros.html">The Rust Programming Language ch 19.5 Macros</a></li>
<li><a href="https://danielkeep.github.io/tlborm/book/index.html">The Little Book of Rust Macros</a></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/knowledgebase/runtime/frame"><span class="arrow-prev">← </span><span>FRAME</span></a><a class="docs-next button" href="/docs/zh-CN/knowledgebase/runtime/metadata"><span>元数据</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#macro-basics">Macro Basics</a></li><li><a href="#substrate-runtime-macros">Substrate Runtime Macros</a></li><li><a href="#overview-of-frame-versioning">Overview of FRAME Versioning</a></li><li><a href="#frame-v1-declarative-macros">FRAME v1 Declarative Macros</a><ul class="toc-headings"><li><a href="#decl_storage">decl_storage!</a></li><li><a href="#decl_event">decl_event!</a></li><li><a href="#decl_error">decl_error!</a></li><li><a href="#decl_module">decl_module!</a></li></ul></li><li><a href="#frame-v2-macros-and-attributes">FRAME v2 Macros and Attributes</a><ul class="toc-headings"><li><a href="#frame_supportpallet">#[frame_support::pallet]</a></li><li><a href="#palletconfig">#[pallet::config]</a></li><li><a href="#palletconstant">#[pallet::constant]</a></li><li><a href="#palletextra_constants">#[pallet::extra_constants]</a></li><li><a href="#palletpallet">#[pallet::pallet]</a></li><li><a href="#pallethooks">#[pallet::hooks]</a></li><li><a href="#palletcall">#[pallet::call]</a></li><li><a href="#palleterror">#[pallet::error]</a></li><li><a href="#palletevents">#[pallet::events]</a></li><li><a href="#palletstorage">#[pallet::storage]</a></li><li><a href="#other-attributes">Other Attributes</a></li></ul></li><li><a href="#additional-frame-macros">Additional FRAME Macros</a><ul class="toc-headings"><li><a href="#construct_runtime">construct_runtime!</a></li><li><a href="#parameter_types">parameter_types!</a></li><li><a href="#impl_outer_origin">impl_outer_origin!</a></li><li><a href="#impl_outer_event">impl_outer_event!</a></li><li><a href="#impl_outer_dispatch">impl_outer_dispatch!</a></li></ul></li><li><a href="#substrate-system-library-macros">Substrate System Library Macros</a><ul class="toc-headings"><li><a href="#impl_runtime_apis">impl_runtime_apis!</a></li><li><a href="#app_crypto">app_crypto!</a></li></ul></li><li><a href="#参考文档">参考文档</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>开发者中心</h5><a href="/zh-CN/tutorials">教程</a><a href="/docs/zh-CN/">知识库</a><a href="https://substrate.dev/recipes/">进阶菜谱</a><a href="https://substrate.dev/substrate-how-to-guides">How-to Guides</a><a href="https://substrate.dev/rustdocs">API 文档</a><a href="https://playground.substrate.dev/">Playground</a></div><div><h5>社区</h5><a href="/zh-CN/community">社区主页</a><a href="/zh-CN/newsletter">通讯</a><a href="https://matrix.to/#/#substrate-technical:matrix.org">Substrate 技术聊天室</a><a href="/zh-CN/seminar">Substrate 研讨会</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/substrate_io" target="_blank" rel="noreferrer noopener">推特</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">聚会活动</a></div><div><h5>更多</h5><a href="https://www.substrate.io/builders-program/">Substrate Builders 计划</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">开发者中心 GitHub</a><a href="https://www.parity.io/privacy/">隐私政策</a><a href="/terms">使用条款</a><a href="#" id="cookie-settings">Cookie 设置<script>
                var cookieSettings = document.getElementById('cookie-settings');
                cookieSettings.onclick = function() {
                  return klaro.show();
                };
              </script></a></div></section><section class="copyright">Copyright © 2021 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>