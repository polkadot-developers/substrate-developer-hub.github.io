<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Runtime Tests · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Runtime tests allow you to verify the logic in your runtime module by mocking a Substrate runtime environment.&lt;/p&gt;
"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="Runtime Tests · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="&lt;p&gt;Runtime tests allow you to verify the logic in your runtime module by mocking a Substrate runtime environment.&lt;/p&gt;
"/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><a href="/zh-CN/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/docs" target="_self">文档</a></li><li class=""><a href="/rustdocs/v1.0/" target="_self">参考文档</a></li><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/zh-CN/community" target="_self">社区</a></li><li class=""><a href="https://github.com/paritytech/substrate" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/next/development/module/tests">English</a></li><li><a href="/docs/ru/next/development/module/tests">Русский</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Runtime Modules</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/getting-started">开始</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/glossary">Glossary</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Conceptual<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/">Conceptual Documentation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Substrate Core</h4><ul><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/core/codec">Parity Scale Codec</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/core/consensus">Consensus</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/core/executor">Executor</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/core/networking">Networking</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/core/storage">Storage</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Substrate Nodes</h4><ul><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/node/client">Client</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/node/light-client">Light Client</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/node/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/node/rpc">RPC</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/node/tx-pool">Transaction Pool</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Substrate Runtime</h4><ul><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/runtime/">Runtime Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/runtime/srml">Substrate Runtime Module Library</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/runtime/contracts">Substrate Smart Contracts</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/runtime/primitives">Runtime Primitives</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Keyring</h4><ul><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/keyring/cryptography">Cryptography</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/keyring/session-keys">Session Keys</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/conceptual/keyring/subkey">Subkey</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Development<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/">Developer Documentation</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Runtime Modules</h4><ul><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/execution">Runtime Execution</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/macros">Runtime Macros</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/origin">Runtime Origin</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/declaration">Declaring a Module</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/storage">Runtime Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/events">Runtime Events</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/errors">Runtime Errors</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/traits">Runtime Configuration Traits</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/module/weight">Transaction Weight</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/next/development/module/tests">Runtime Tests</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Deployment</h4><ul><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/deployment/chain-spec">Chain Specification</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/deployment/account-prefix">Account Prefix</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/deployment/boot-node">Boot Nodes</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/deployment/disabling-features">Disabling Features of Your Runtime</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Front End</h4><ul><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/front-end/polkadot-js">Polkadot-JS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/development/front-end/json-rpc">JSON RPC</a></li></ul></div></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 class="postHeaderTitle">Runtime Tests</h1></header><article><div><span><p>Runtime tests allow you to verify the logic in your runtime module by mocking a Substrate runtime environment.</p>
<h2><a class="anchor" aria-hidden="true" id="unit-testing"></a><a href="#unit-testing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unit Testing</h2>
<p>Substrate uses the existing <a href="https://doc.rust-lang.org/rust-by-example/testing/unit_testing.html">unit testing</a> framework provided by Rust.</p>
<p>The average runtime test will look like:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">my_runtime_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">with_externalities</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token function">new_test_ext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token punctuation">|</span><span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token function">some_assertion!</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="mock-runtime-environment"></a><a href="#mock-runtime-environment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock Runtime Environment</h2>
<p>To support the specific needs of testing a Substrate runtime, you need to construct a &quot;mock&quot; runtime environment. This involves importing the logic of other runtime modules, such as the System module, and establishing runtime storage.</p>
<p>In general, we suggest looking at and mimicking the various examples of runtime tests in the Substrate Runtime Module Library (SRML). This document won't be as comprehensive as what is provided in our SRML.</p>
<h3><a class="anchor" aria-hidden="true" id="mock-runtime-modules"></a><a href="#mock-runtime-modules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock Runtime Modules</h3>
<p>To test your module, you will need to construct a configuration type (<code>Test</code>) which implements each of the configuration traits of modules you want to use.</p>
<pre><code class="hljs css language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> Test<span class="token punctuation">;</span>
<span class="token comment">// Implement the System module traits</span>
<span class="token keyword">impl</span> system<span class="token punctuation">:</span><span class="token punctuation">:</span>Trait <span class="token keyword">for</span> Test <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
<span class="token comment">// Implement your custom module traits</span>
<span class="token keyword">impl</span> Trait <span class="token keyword">for</span> Test <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
<span class="token comment">// Create a friendly alias to access your module</span>
<span class="token keyword">type</span> MyModule <span class="token operator">=</span> Module<span class="token operator">&lt;</span>Test<span class="token operator">></span><span class="token punctuation">;</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="mock-primitives"></a><a href="#mock-primitives" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock Primitives</h4>
<p>When implementing the configuration traits of modules you want to use in your tests, you should choose primitives which makes your life easier. For example:</p>
<pre><code class="hljs css language-rust"><span class="token keyword">impl</span> system<span class="token punctuation">:</span><span class="token punctuation">:</span>Trait <span class="token keyword">for</span> Test <span class="token punctuation">{</span>
    <span class="token keyword">type</span> Origin <span class="token operator">=</span> Origin<span class="token punctuation">;</span>
    <span class="token keyword">type</span> Index <span class="token operator">=</span> u64<span class="token punctuation">;</span>
    <span class="token keyword">type</span> BlockNumber <span class="token operator">=</span> u64<span class="token punctuation">;</span>
    <span class="token keyword">type</span> Hash <span class="token operator">=</span> H256<span class="token punctuation">;</span>
    <span class="token keyword">type</span> Call <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">type</span> Hashing <span class="token operator">=</span> BlakeTwo256<span class="token punctuation">;</span>
    <span class="token keyword">type</span> AccountId <span class="token operator">=</span> u64<span class="token punctuation">;</span>
    <span class="token comment">//--snip--</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here you can see that a core runtime type like <code>AccountId</code> can simply be set to <code>u64</code> rather than using real cryptographic primitives like <code>SR25519</code>. This means that to access accounts in your test, you simply need to pass an integer rather than more complicated stuff.</p>
<p>In cases where you do not need to use a type, like <code>Call</code> in the example above, you can pass the unit type <code>()</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="mock-runtime-storage"></a><a href="#mock-runtime-storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock Runtime Storage</h3>
<p>The <code>runtime-io</code> crate exposes two helpers for establishing storage for tests:</p>
<ul>
<li><p><code>TestExternalities</code>: An in-memory, hashmap-based externalities implementation. In other words, it mocks a test storage needed for the runtime to execute in a minimal fashion.</p></li>
<li><p><code>with_externalities</code>: A function that allows you to run logic on top of a <code>TestExternalities</code> storage.</p></li>
</ul>
<p><code>TestExternalities</code> is generated from building storage off of a genesis configuration. That looks like:</p>
<pre><code class="hljs css language-rust"><span class="token comment">// This function basically just builds a genesis storage key/value store according to our desired mockup.</span>
<span class="token keyword">fn</span> <span class="token function">new_test_ext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> runtime_io<span class="token punctuation">:</span><span class="token punctuation">:</span>TestExternalities<span class="token operator">&lt;</span>Blake2Hasher<span class="token operator">></span> <span class="token punctuation">{</span>
    system<span class="token punctuation">:</span><span class="token punctuation">:</span>GenesisConfig<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>build_storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">&lt;</span>Test<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="configuring-genesis"></a><a href="#configuring-genesis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring Genesis</h4>
<p>You can set custom values for the genesis configuration for modules you include in your mock runtime.</p>
<p>TODO</p>
<h3><a class="anchor" aria-hidden="true" id="block-production"></a><a href="#block-production" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Block Production</h3>
<p>Your tests may require you to simulate block production to move forward the state of your chain.</p>
<p>You will need to emulate the orchestration provided by the Executive module in order for your runtime to behave correctly.</p>
<p>Usually this means executing the <code>on_initialize</code> and <code>on_finalize</code> functions of all the modules included in your test, and incrementing the block number tracked by the System module. This can be written as a function you include in your unit tests:</p>
<pre><code class="hljs css language-rust"><span class="token keyword">fn</span> <span class="token function">run_to_block</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> u64<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> n <span class="token punctuation">{</span>
        MyModule<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on_finalize</span><span class="token punctuation">(</span>System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on_finalize</span><span class="token punctuation">(</span>System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set_block_number</span><span class="token punctuation">(</span>System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on_initialize</span><span class="token punctuation">(</span>System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        MyModule<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on_initialize</span><span class="token punctuation">(</span>System<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can then use this function in your unit tests:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">my_runtime_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">with_externalities</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token function">new_test_ext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token punctuation">|</span><span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token function">assert_ok!</span><span class="token punctuation">(</span>MyModule<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">start_auction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">run_to_block</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assert_ok!</span><span class="token punctuation">(</span>MyModule<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">end_auction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="后续步骤"></a><a href="#后续步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续步骤</h2>
<h3><a class="anchor" aria-hidden="true" id="learn-more"></a><a href="#learn-more" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Learn More</h3>
<p>TODO</p>
<h3><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h3>
<p>TODO</p>
<h3><a class="anchor" aria-hidden="true" id="references"></a><a href="#references" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h3>
<p>TODO</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/next/development/module/weight"><span class="arrow-prev">← </span><span>Transaction Weight</span></a><a class="docs-next button" href="/docs/zh-CN/next/development/deployment/chain-spec"><span>Chain Specification</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#unit-testing">Unit Testing</a></li><li><a href="#mock-runtime-environment">Mock Runtime Environment</a><ul class="toc-headings"><li><a href="#mock-runtime-modules">Mock Runtime Modules</a></li><li><a href="#mock-runtime-storage">Mock Runtime Storage</a></li><li><a href="#block-production">Block Production</a></li></ul></li><li><a href="#后续步骤">后续步骤</a><ul class="toc-headings"><li><a href="#learn-more">Learn More</a></li><li><a href="#examples">Examples</a></li><li><a href="#references">References</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><div><style>
#blast {
  display: block;
  position: fixed;
  width: 100%;
  top: -50px;
  left: 0;
  right: 0;
  height: 50px;
  background: #ff1864 url(/img/hacktoberfest-blast-bg.png);
  color: white;
  // transform: translateY(-100%);
}

#blast h2 {
  margin: 0;
  line-height: 45px;
  text-align: center;
}

#blast a {
  color: white;
  text-decoration: underline;
}

body {
  transform: translateY(50px)
}
</style><section id="blast"><h2>Hacktoberfest is here! <a href="https://substrate.dev/hacktoberfest">Hack with us</a></h2></section></div><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/zh-CN/getting-started">Getting Started</a><a href="/zh-CN/tutorials">Tutorials</a><a href="/rustdocs/v1.0/">Reference Docs</a><a href="/recipes/">Recipes</a></div><div><h5>Community</h5><a href="/zh-CN/videos">Videos</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://riot.im/app/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Riot Chat</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">Events</a></div><div><h5>More</h5><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a><a href="https://www.parity.io/privacy/">Privacy Policy</a><a href="#" id="cookie-settings">Cookie Settings<script>
              var cookieSettings = document.getElementById('cookie-settings');
              cookieSettings.onclick = function() {
                return klaro.show();
              };
              </script></a></div></section><section class="copyright">Copyright © 2019 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>