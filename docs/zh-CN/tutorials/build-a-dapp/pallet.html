<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Building a Custom Pallet · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The Substrate Developer Hub Node Template, which is used as the starting point for this tutorial, has a FRAME-based [runtime](https://substrate.dev/docs/en/knowledgebase/runtime/). [FRAME](https://substrate.dev/docs/en/knowledgebase/runtime/frame) is a library of code that allows you to build a Substrate runtime by composing modules called &quot;pallets&quot;. You can think of these pallets as individual pieces of logic that define what your blockchain can do! Substrate provides you with a number of pre-built pallets for use in FRAME-based runtimes."/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="Building a Custom Pallet · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="The Substrate Developer Hub Node Template, which is used as the starting point for this tutorial, has a FRAME-based [runtime](https://substrate.dev/docs/en/knowledgebase/runtime/). [FRAME](https://substrate.dev/docs/en/knowledgebase/runtime/frame) is a library of code that allows you to build a Substrate runtime by composing modules called &quot;pallets&quot;. You can think of these pallets as individual pieces of logic that define what your blockchain can do! Substrate provides you with a number of pre-built pallets for use in FRAME-based runtimes."/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/redirect-next.js"></script><script type="text/javascript" src="/js/ui.js" defer=""></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/docs/zh-CN/" target="_self">Knowledge Base</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">Recipes</a></li><li class=""><a href="https://substrate.dev/rustdocs/" target="_self">Reference Documents</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/tutorials/build-a-dapp/pallet">English</a></li><li><a href="/docs/ru/tutorials/build-a-dapp/pallet">Русский</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">协助翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Build a PoE Decentralized Application</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Build a PoE Decentralized Application<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/">介绍</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/prepare">Prepare to build a dApp</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/pallet">Building a Custom Pallet</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/tutorials/build-a-dapp/front-end">Building a Custom Front End</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">Building a Custom Pallet</h1></header><article><div><span><p>The Substrate Developer Hub Node Template, which is used as the starting point for this tutorial, has a FRAME-based <a href="https://substrate.dev/docs/en/knowledgebase/runtime/">runtime</a>. <a href="https://substrate.dev/docs/en/knowledgebase/runtime/frame">FRAME</a> is a library of code that allows you to build a Substrate runtime by composing modules called &quot;pallets&quot;. You can think of these pallets as individual pieces of logic that define what your blockchain can do! Substrate provides you with a number of pre-built pallets for use in FRAME-based runtimes.</p>
<p><img src="/docs/assets/tutorials/build-a-dapp/frame-runtime.png" alt="Runtime Composition"></p>
<p>For example, FRAME includes a <a href="https://substrate.dev/rustdocs/v2.0.0-rc6/pallet_balances/">Balances</a> pallet that controls the underlying currency of your blockchain by managing the <em>balance</em> of all the accounts in your system.</p>
<p>If you want to add smart contract functionality to your blockchain, you simply need to include the <a href="https://substrate.dev/rustdocs/v2.0.0-rc6/pallet_contracts/">Contracts</a> pallet.</p>
<p>Even things like on-chain governance can be added to your blockchain by including pallets like <a href="https://substrate.dev/rustdocs/v2.0.0-rc6/pallet_democracy/">Democracy</a>, <a href="https://substrate.dev/rustdocs/v2.0.0-rc6/pallet_elections/">Elections</a>, and <a href="https://substrate.dev/rustdocs/v2.0.0-rc6/pallet_collective/">Collective</a>.</p>
<p>The goal of this tutorial is to teach you how to create your own FRAME pallet to include in your custom blockchain! The Substrate Developer Hub Node Template comes with a template pallet that you will use as a starting point to build custom runtime logic on top of.</p>
<h2><a class="anchor" aria-hidden="true" id="file-structure"></a><a href="#file-structure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>File Structure</h2>
<p>Open the Node Template in your favorite code editor, then open the file <code>pallets/template/src/lib.rs</code></p>
<pre><code class="hljs">substrate<span class="token operator">-</span>node<span class="token operator">-</span>template
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> node
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> pallets
<span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> template
<span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token class-name">Cargo</span><span class="token punctuation">.</span>toml    <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token class-name">One</span> change <span class="token keyword">in</span> this file
<span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> src
<span class="token operator">|</span>           <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> lib<span class="token punctuation">.</span>rs     <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token class-name">Most</span> changes <span class="token keyword">in</span> this file
<span class="token operator">|</span>           <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> mock<span class="token punctuation">.</span>rs
<span class="token operator">|</span>           <span class="token operator">|</span>
<span class="token operator">|</span>           <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> tests<span class="token punctuation">.</span>rs
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> runtime
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> scripts
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token punctuation">...</span>
</code></pre>
<p>You will see some pre-written code that acts as a template for a new pallet. You can read over this file if you'd like, and then delete the contents since we will start from scratch for full transparency. When writing your own pallets in the future, you will likely find the scaffolding in this template pallet useful.</p>
<h2><a class="anchor" aria-hidden="true" id="build-your-new-pallet"></a><a href="#build-your-new-pallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build Your New Pallet</h2>
<p>At a high level, a FRAME pallet can be broken down into six sections:</p>
<pre><code class="hljs css language-rust"><span class="token comment">// 1. Imports</span>
<span class="token keyword">use</span> <span class="token namespace">frame_support<span class="token punctuation">::</span></span><span class="token punctuation">{</span>decl_module<span class="token punctuation">,</span> decl_storage<span class="token punctuation">,</span> decl_event<span class="token punctuation">,</span> decl_error<span class="token punctuation">,</span> dispatch<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">frame_system<span class="token punctuation">::</span></span>ensure_signed<span class="token punctuation">;</span>

<span class="token comment">// 2. Configuration</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Trait</span><span class="token punctuation">:</span> <span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">Trait</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 3. Storage</span>
<span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 4. Events</span>
<span class="token macro property">decl_event!</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 5. Errors</span>
<span class="token macro property">decl_error!</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>

<span class="token comment">// 6. Callable Functions</span>
<span class="token macro property">decl_module!</span> <span class="token punctuation">{</span> <span class="token comment">/* --snip-- */</span> <span class="token punctuation">}</span>
</code></pre>
<p>Things like events, storage, and callable functions may look familiar to you if you have done other blockchain development. We will show you what each of these components looks like for a basic Proof Of Existence pallet.</p>
<h3><a class="anchor" aria-hidden="true" id="imports-and-dependencies"></a><a href="#imports-and-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Imports and Dependencies</h3>
<p>Since imports are pretty boring, you can start by pasting this at the top of your empty <code>lib.rs</code> file:</p>
<pre><code class="hljs css language-rust"><span class="token attribute attr-name">#![cfg_attr(not(feature = <span class="token string">"std"</span>), no_std)]</span>

<span class="token keyword">use</span> <span class="token namespace">frame_support<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    decl_module<span class="token punctuation">,</span> decl_storage<span class="token punctuation">,</span> decl_event<span class="token punctuation">,</span> decl_error<span class="token punctuation">,</span> ensure<span class="token punctuation">,</span> <span class="token class-name">StorageMap</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">frame_system<span class="token punctuation">::</span></span>ensure_signed<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">sp_std<span class="token punctuation">::</span>vec<span class="token punctuation">::</span></span><span class="token class-name">Vec</span><span class="token punctuation">;</span>
</code></pre>
<p>Most of these imports are already available because they were used in the template pallet whose code we just deleted. However, <code>sp_std</code> is not available and we need to list it as a dependency.</p>
<p><strong>Add</strong> this block to your <code>pallets/template/Cargo.toml</code> file.</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies.sp-std</span><span class="token punctuation">]</span>
<span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/paritytech/substrate.git'</span>
<span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token key property">tag</span> <span class="token punctuation">=</span> <span class="token string">'v2.0.0-rc6'</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">'2.0.0-rc6'</span>
</code></pre>
<p>Then, <strong>Update</strong> the existing <code>[features]</code> block to look like this. The last line is new. You will learn more about why this is necessary in the next tutorial, the <a href="../add-a-pallet">Add a Pallet</a> tutorial.</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">features</span><span class="token punctuation">]</span>
<span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">'std'</span><span class="token punctuation">]</span>
<span class="token key property">std</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
    <span class="token string">'codec/std'</span><span class="token punctuation">,</span>
    <span class="token string">'frame-support/std'</span><span class="token punctuation">,</span>
    <span class="token string">'frame-system/std'</span><span class="token punctuation">,</span>
    <span class="token string">'sp-std/std'</span><span class="token punctuation">,</span>          &lt;-- This line is new
<span class="token punctuation">]</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<p>Every pallet has a component called <code>Trait</code> that is used for configuration. This component is a <a href="https://doc.rust-lang.org/book/ch10-02-traits.html">Rust &quot;trait&quot;</a>; traits in Rust are similar to interfaces in languages such as C++, Java and Go. For now, the only thing we will configure about our pallet is that it will emit some Events. The <code>Trait</code> interface is another topic that will be covered in greater depth in the next tutorial, the <a href="../add-a-pallet">Add a Pallet</a> tutorial.</p>
<pre><code class="hljs css language-rust"><span class="token comment">/// Configure the pallet by specifying the parameters and types on which it depends.</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Trait</span><span class="token punctuation">:</span> <span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">Trait</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Because this pallet emits events, it depends on the runtime's definition of an event.</span>
    <span class="token keyword">type</span> <span class="token class-name">Event</span><span class="token punctuation">:</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">Event</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">>></span> <span class="token operator">+</span> <span class="token class-name">Into</span><span class="token operator">&lt;&lt;</span><span class="token keyword">Self</span> <span class="token keyword">as</span> <span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">Trait</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token class-name">Event</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="events"></a><a href="#events" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Events</h3>
<p>After we've configured our pallet to emit events, let's go ahead and define which events:</p>
<pre><code class="hljs css language-rust"><span class="token comment">// Pallets use events to inform users when important changes are made.</span>
<span class="token comment">// Event documentation should end with an array that provides descriptive names for parameters.</span>
<span class="token comment">// https://substrate.dev/docs/en/knowledgebase/runtime/events</span>
<span class="token macro property">decl_event!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Event</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">where</span> <span class="token class-name">AccountId</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token class-name">T</span> <span class="token keyword">as</span> <span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">Trait</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token class-name">AccountId</span> <span class="token punctuation">{</span>
        <span class="token comment">/// Event emitted when a proof has been claimed. [who, claim]</span>
        <span class="token class-name">ClaimCreated</span><span class="token punctuation">(</span><span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">/// Event emitted when a claim is revoked by the owner. [who, claim]</span>
        <span class="token class-name">ClaimRevoked</span><span class="token punctuation">(</span><span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Our pallet will only emit an event in two circumstances:</p>
<ol>
<li>When a new proof is added to the blockchain.</li>
<li>When a proof is removed.</li>
</ol>
<p>The events can contain some additional data, in this case, each event will also display who triggered the event (<code>AccountId</code>), and the proof data (as <code>Vec&lt;u8&gt;</code>) that is being stored or removed. Note that convention is to include an array with descriptive names for these parameters at the end of event documentation.</p>
<h2><a class="anchor" aria-hidden="true" id="errors"></a><a href="#errors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Errors</h2>
<p>The events we defined previously indicate when calls to the pallet have completed successfully. Similarly, errors indicate when a call has failed, and why it has failed.</p>
<pre><code class="hljs css language-rust"><span class="token comment">// Errors inform users that something went wrong.</span>
<span class="token macro property">decl_error!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Error</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment">/// The proof has already been claimed.</span>
        <span class="token class-name">ProofAlreadyClaimed</span><span class="token punctuation">,</span>
        <span class="token comment">/// The proof does not exist, so it cannot be revoked.</span>
        <span class="token class-name">NoSuchProof</span><span class="token punctuation">,</span>
        <span class="token comment">/// The proof is claimed by another account, so caller can't revoke it.</span>
        <span class="token class-name">NotProofOwner</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The first of these errors can occur when attempting to claim a new proof. Of course a user cannot claim a proof that has already been claimed. The latter two can occur when attempting to revoke a proof.</p>
<h3><a class="anchor" aria-hidden="true" id="storage"></a><a href="#storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage</h3>
<p>To add a new proof to the blockchain, we will simply store that proof in our pallet's storage. To store that value, we will create a <a href="https://en.wikipedia.org/wiki/Hash_table">hash map</a> from the proof to the owner of that proof and the block number the proof was made.</p>
<pre><code class="hljs css language-rust"><span class="token comment">// The pallet's runtime storage items.</span>
<span class="token comment">// https://substrate.dev/docs/en/knowledgebase/runtime/storage</span>
<span class="token macro property">decl_storage!</span> <span class="token punctuation">{</span>
    <span class="token keyword">trait</span> <span class="token class-name">Store</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token keyword">as</span> <span class="token class-name">TemplateModule</span> <span class="token punctuation">{</span>
        <span class="token comment">/// The storage item for our proofs.</span>
        <span class="token comment">/// It maps a proof to the user who made the claim and when they made it.</span>
        <span class="token class-name">Proofs</span><span class="token punctuation">:</span> map <span class="token function">hasher</span><span class="token punctuation">(</span>blake2_128_concat<span class="token punctuation">)</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">BlockNumber</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>If a proof has an owner and a block number, then we know that it has been claimed! Otherwise, the proof is available to be claimed.</p>
<h3><a class="anchor" aria-hidden="true" id="callable-functions"></a><a href="#callable-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Callable Functions</h3>
<p>As implied by our pallet's events and errors, we will have two &quot;dispatchable functions&quot; the user can call in this FRAME pallet:</p>
<ol>
<li><code>create_claim()</code>: Allow a user to claim the existence of a file with a proof.</li>
<li><code>revoke_claim()</code>: Allow the owner of a claim to revoke their claim.</li>
</ol>
<pre><code class="hljs css language-rust"><span class="token comment">// Dispatchable functions allows users to interact with the pallet and invoke state changes.</span>
<span class="token comment">// These functions materialize as "extrinsics", which are often compared to transactions.</span>
<span class="token comment">// Dispatchable functions must be annotated with a weight and must return a DispatchResult.</span>
<span class="token macro property">decl_module!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Call</span> <span class="token keyword">where</span> origin<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">Origin</span> <span class="token punctuation">{</span>
        <span class="token comment">// Errors must be initialized if they are used by the pallet.</span>
        <span class="token keyword">type</span> <span class="token class-name">Error</span> <span class="token operator">=</span> <span class="token class-name">Error</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">;</span>

        <span class="token comment">// Events must be initialized if they are used by the pallet.</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">deposit_event</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> default<span class="token punctuation">;</span>

        <span class="token comment">/// Allow a user to claim ownership of an unclaimed proof.</span>
        <span class="token attribute attr-name">#[weight = 10_000]</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">create_claim</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proof<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Check that the extrinsic was signed and get the signer.</span>
            <span class="token comment">// This function will return an error if the extrinsic is not signed.</span>
            <span class="token comment">// https://substrate.dev/docs/en/knowledgebase/runtime/origin</span>
            <span class="token keyword">let</span> sender <span class="token operator">=</span> <span class="token function">ensure_signed</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

            <span class="token comment">// Verify that the specified proof has not already been claimed.</span>
            <span class="token macro property">ensure!</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Proofs</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token class-name">ProofAlreadyClaimed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Get the block number from the FRAME System module.</span>
            <span class="token keyword">let</span> current_block <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">>></span><span class="token punctuation">::</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Store the proof with the sender and block number.</span>
            <span class="token class-name">Proofs</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>sender<span class="token punctuation">,</span> current_block<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Emit an event that the claim was created.</span>
            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">deposit_event</span><span class="token punctuation">(</span><span class="token class-name">RawEvent</span><span class="token punctuation">::</span><span class="token class-name">ClaimCreated</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> proof<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// Allow the owner to revoke their claim.</span>
        <span class="token attribute attr-name">#[weight = 10_000]</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">revoke_claim</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> proof<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Check that the extrinsic was signed and get the signer.</span>
            <span class="token comment">// This function will return an error if the extrinsic is not signed.</span>
            <span class="token comment">// https://substrate.dev/docs/en/knowledgebase/runtime/origin</span>
            <span class="token keyword">let</span> sender <span class="token operator">=</span> <span class="token function">ensure_signed</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

            <span class="token comment">// Verify that the specified proof has been claimed.</span>
            <span class="token macro property">ensure!</span><span class="token punctuation">(</span><span class="token class-name">Proofs</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token class-name">NoSuchProof</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Get owner of the claim.</span>
            <span class="token keyword">let</span> <span class="token punctuation">(</span>owner<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token class-name">Proofs</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Verify that sender of the current call is the claim owner.</span>
            <span class="token macro property">ensure!</span><span class="token punctuation">(</span>sender <span class="token operator">==</span> owner<span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token class-name">NotProofOwner</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Remove claim from storage.</span>
            <span class="token class-name">Proofs</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>proof<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Emit an event that the claim was erased.</span>
            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">deposit_event</span><span class="token punctuation">(</span><span class="token class-name">RawEvent</span><span class="token punctuation">::</span><span class="token class-name">ClaimRevoked</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> proof<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>The functions you see here do not have return types explicitly stated. In reality they all return <a href="https://substrate.dev/rustdocs/v2.0.0-rc6/frame_support/dispatch/type.DispatchResult.html"><code>DispatchResult</code></a>s. This return type is added on your behalf by the <code>decl_module!</code> macro.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="compile-your-new-pallet"></a><a href="#compile-your-new-pallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compile Your New Pallet</h2>
<p>After you've copied all of the parts of this pallet correctly into your <code>pallets/template/lib.rs</code> file, you should be able to recompile your node without warning or error. Run this command in the root directory of the <code>substrate-node-template</code> repository.</p>
<pre><code class="hljs css language-bash">cargo build --release
</code></pre>
<p>Now you can start your node:</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># Run a temporary node in development mode</span>
./target/release/node-template --dev --tmp
</code></pre>
<p>Now it is time to interact with our new Proof of Existence pallet!</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/tutorials/build-a-dapp/prepare"><span class="arrow-prev">← </span><span class="function-name-prevnext">Prepare to build a dApp</span></a><a class="docs-next button" href="/docs/zh-CN/tutorials/build-a-dapp/front-end"><span>Building a Custom Front End</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#file-structure">File Structure</a></li><li><a href="#build-your-new-pallet">Build Your New Pallet</a><ul class="toc-headings"><li><a href="#imports-and-dependencies">Imports and Dependencies</a></li><li><a href="#configuration">Configuration</a></li><li><a href="#events">Events</a></li></ul></li><li><a href="#errors">Errors</a><ul class="toc-headings"><li><a href="#storage">Storage</a></li><li><a href="#callable-functions">Callable Functions</a></li></ul></li><li><a href="#compile-your-new-pallet">Compile Your New Pallet</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Developer Hub</h5><a href="/zh-CN/tutorials">Tutorials</a><a href="/docs/zh-CN/">Knowledge Base</a><a href="https://substrate.dev/recipes/">Recipes</a><a href="https://substrate.dev/rustdocs">Reference Documents</a></div><div><h5>Community</h5><a href="/zh-CN/community">Community Home</a><a href="/zh-CN/newsletter">Newsletter</a><a href="https://app.element.io/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Substrate Technical Chat</a><a href="/zh-CN/seminar">Substrate Seminar</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/ParityTech" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">Events</a></div><div><h5>More</h5><a href="https://www.substrate.io/builders-program/">Substrate Builders Program</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">Developer Hub GitHub</a><a href="https://www.parity.io/privacy/">Privacy Policy</a><a href="/terms">Terms of Use</a><a href="#" id="cookie-settings">Cookie Settings<script>
              var cookieSettings = document.getElementById('cookie-settings');
              cookieSettings.onclick = function() {
                return klaro.show();
              };
              </script></a></div></section><section class="copyright">Copyright © 2020 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>