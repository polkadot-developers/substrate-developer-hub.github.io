<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>在 Runtime 里添加 Contracts 模块 · Substrate Developer Hub</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="As you saw in the [Create your first Substrate blockchain](../tutorials/create-your-first-substrate-chain) tutorial, the [Substrate node template](https://github.com/substrate-developer-hub/substrate-node-template) provides a working runtime that you can use to start building your own blockchain. The node template includes a runtime that is constructed using the [FRAME](../../knowledgebase/runtime/frame) development framework and includes some **pallets** to get you started."/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="在 Runtime 里添加 Contracts 模块 · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="As you saw in the [Create your first Substrate blockchain](../tutorials/create-your-first-substrate-chain) tutorial, the [Substrate node template](https://github.com/substrate-developer-hub/substrate-node-template) provides a working runtime that you can use to start building your own blockchain. The node template includes a runtime that is constructed using the [FRAME](../../knowledgebase/runtime/frame) development framework and includes some **pallets** to get you started."/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script><script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/past-seminars.js"></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/docs/zh-CN/" target="_self">知识库</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">进阶菜谱</a></li><li class=""><a href="https://substrate.dev/substrate-how-to-guides/" target="_self">How-to Guides</a></li><li class=""><a href="https://substrate.dev/rustdocs/" target="_self">Reference</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>简体中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/tutorials/add-contracts-pallet">English</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">协助翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">在 Runtime 里添加 Contracts 模块</h1></header><article><div><span><p>As you saw in the <a href="../tutorials/create-your-first-substrate-chain">Create your first Substrate blockchain</a> tutorial, the <a href="https://github.com/substrate-developer-hub/substrate-node-template">Substrate node template</a> provides a working runtime that you can use to start building your own blockchain. The node template includes a runtime that is constructed using the <a href="../../knowledgebase/runtime/frame">FRAME</a> development framework and includes some <strong>pallets</strong> to get you started.</p>
<p>In this tutorial, you'll learn how to add the <a href="https://substrate.dev/rustdocs/latest/pallet_contracts/">Contract pallet</a> to the node template.</p>
<p>You can follow similar patterns to add other FRAME pallets to your runtime. However, each pallet requires you to configure specific parameters and types and you must set them correctly before you can use the pallet. This tutorial illustrates how to configure the parameters and types that the Contracts pallet requires.</p>
<h2><a class="anchor" aria-hidden="true" id="before-you-begin"></a><a href="#before-you-begin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Before you begin</h2>
<p>Before starting this tutorial, verify the following:</p>
<ul>
<li><p>You have downloaded and compiled the <code>latest</code> version of the <a href="https://github.com/substrate-developer-hub/substrate-node-template/tree/latest">Substrate node template</a>.</p>
<p>If you have not previously compiled the node template on your computer, follow the instructions in the <a href="../../tutorials/create-your-first-substrate-chain/">Create your first Substrate chain</a> tutorial before continuing.</p></li>
<li><p>You have downloaded and installed the <a href="https://github.com/substrate-developer-hub/substrate-node-template/tree/latest">Substrate front-end template</a> as described in the <a href="../../tutorials/create-your-first-substrate-chain/">Create your first Substrate chain</a> tutorial before continuing.</p></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="file-structure"></a><a href="#file-structure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>File structure</h2>
<p>In this tutorial, you are going to modify the <code>substrate-node-template</code> to include the Contracts pallet by editing some files in the <code>substrate-node-template</code> directory. The directory structure for the node template looks like this:</p>
<pre><code class="hljs">substrate<span class="token operator">-</span>node<span class="token operator">-</span>template
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> runtime
<span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token class-name">Cargo</span><span class="token punctuation">.</span>toml <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token class-name">Changes</span> are required <span class="token keyword">in</span> this file
<span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> build<span class="token punctuation">.</span>rs
<span class="token operator">|</span>   <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> src
<span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> lib<span class="token punctuation">.</span>rs   <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token class-name">Changes</span> are required <span class="token keyword">in</span> this file
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> pallets
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> scripts
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> node           <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token class-name">Changes</span> are required <span class="token keyword">in</span> this directory
<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token punctuation">...</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="add-the-crate-for-the-contract-pallet-to-the-node-template"></a><a href="#add-the-crate-for-the-contract-pallet-to-the-node-template" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add the crate for the Contract pallet to the node template</h2>
<p>To add the Contracts pallet to the node template, you first must import the <code>pallet-contracts</code> crate by modifying the <code>Cargo.toml</code> file for the runtime environment.</p>
<p>To import the <code>pallet-contracts</code> crate:</p>
<ol>
<li><p>Open a terminal shell and change to the root directory for the node template.</p></li>
<li><p>Open the <code>runtime/Cargo.toml</code> configuration file in a text editor.</p>
<p>The <code>Cargo.toml</code> file lists of all the dependencies for the node template runtime. For example, you can see that the runtime depends on the <a href="https://substrate.dev/rustdocs/latest/pallet_balances/">Balances pallet</a> because it has a [dependencies.pallet-balances] section.</p></li>
<li><p>Import the <code>pallet-contracts</code> crate to make it available to the node template runtime by adding it to the list of dependencies.</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies.pallet-contracts</span><span class="token punctuation">]</span>
<span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/paritytech/substrate.git'</span>
<span class="token key property">tag</span> <span class="token punctuation">=</span> <span class="token string">'monthly-YYYY-MM'</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">'4.0.0-dev'</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies.pallet-contracts-primitives</span><span class="token punctuation">]</span>
<span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/paritytech/substrate.git'</span>
<span class="token key property">tag</span> <span class="token punctuation">=</span> <span class="token string">'monthly-YYYY-MM'</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">'4.0.0-dev'</span>
</code></pre></li>
</ol>
<p>The Contracts pallet is one of the more complicated pallets in FRAME, so it makes a good example to illustrate how to add pallets. NOTE: When adding a new dependency to the <code>Cargo.toml</code> file, be sure that the <code>tag</code> you use is the same for all of the pallet crates you are importing. For example, if all of the other dependency use <code>tag = 'monthly-2021-09+1'</code>, replace <code>tag = 'monthly-YYYY-MM'</code> with <code>tag = 'monthly-2021-09+1'</code>.</p>
<ol>
<li><p>Add the Contracts pallet to the list of <code>std</code> features so that its features are included when the runtime is built as a native Rust binary.</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">features</span><span class="token punctuation">]</span>
<span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">'std'</span><span class="token punctuation">]</span>
<span class="token key property">std</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
 <span class="token comment">#--snip--</span>
 <span class="token string">'pallet-contracts/std'</span><span class="token punctuation">,</span>
 <span class="token string">'pallet-contracts-primitives/std'</span><span class="token punctuation">,</span>
 <span class="token comment">#--snip--</span>
 <span class="token punctuation">]</span>
</code></pre></li>
<li><p>Save your changes and close the <code>runtime/Cargo.toml</code> file.</p></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="implement-the-contracts-configuration-trait"></a><a href="#implement-the-contracts-configuration-trait" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implement the Contracts configuration trait</h2>
<p>Now that you have successfully imported the Contracts pallet crate, you are ready to add it to the runtime. If you have explored other tutorials, you might already know that every pallet has a configuration trait—called <code>Config</code>—that the runtime must implement.</p>
<p>To determine what you need to implement for the Contracts pallet, you can take a look at the FRAME <a href="https://substrate.dev/rustdocs/latest/pallet_contracts/pallet/trait.Config.html"><code>pallet_contracts::Config</code> documentation</a>.</p>
<p>To implement the <code>Config</code> trait for the Contracts pallet in the runtime:</p>
<ol>
<li><p>Open the <code>runtime/src/lib.rs</code> file in a text editor.</p></li>
<li><p>Locate the <code>pub use frame_support</code> block and add <code>Nothing</code> to the list of traits.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">frame_support<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
 construct_runtime<span class="token punctuation">,</span> parameter_types<span class="token punctuation">,</span>
 <span class="token namespace">traits<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">KeyOwnerProofSystem</span><span class="token punctuation">,</span> <span class="token class-name">Randomness</span><span class="token punctuation">,</span> <span class="token class-name">StorageInfo</span><span class="token punctuation">,</span> <span class="token class-name">Nothing</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token namespace">weights<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
 <span class="token namespace">constants<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BlockExecutionWeight</span><span class="token punctuation">,</span> <span class="token class-name">ExtrinsicBaseWeight</span><span class="token punctuation">,</span> <span class="token class-name">RocksDbWeight</span><span class="token punctuation">,</span> <span class="token constant">WEIGHT_PER_SECOND</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">IdentityFee</span><span class="token punctuation">,</span> <span class="token class-name">Weight</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token class-name">StorageValue</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></li>
<li><p>Add the <code>WeightInfo</code> property to the runtime.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token comment">/* After this line */</span>
<span class="token keyword">use</span> <span class="token namespace">pallet_transaction_payment<span class="token punctuation">::</span></span><span class="token class-name">CurrencyAdapter</span><span class="token punctuation">;</span>
<span class="token comment">/*** Add this line ***/</span>
<span class="token keyword">use</span> <span class="token namespace">pallet_contracts<span class="token punctuation">::</span>weights<span class="token punctuation">::</span></span><span class="token class-name">WeightInfo</span><span class="token punctuation">;</span>
</code></pre></li>
<li><p>Add the constants required by the Contracts pallet to the runtime.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token comment">/* After this block */</span>
<span class="token comment">// Time is measured by number of blocks.</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">MINUTES</span><span class="token punctuation">:</span> <span class="token class-name">BlockNumber</span> <span class="token operator">=</span> <span class="token number">60_000</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token constant">MILLISECS_PER_BLOCK</span> <span class="token keyword">as</span> <span class="token class-name">BlockNumber</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">HOURS</span><span class="token punctuation">:</span> <span class="token class-name">BlockNumber</span> <span class="token operator">=</span> <span class="token constant">MINUTES</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">DAYS</span><span class="token punctuation">:</span> <span class="token class-name">BlockNumber</span> <span class="token operator">=</span> <span class="token constant">HOURS</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">;</span>

<span class="token comment">/* Add this block */</span>
<span class="token comment">// Contracts price units.</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">MILLICENTS</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token number">1_000_000_000</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">CENTS</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token number">1_000</span> <span class="token operator">*</span> <span class="token constant">MILLICENTS</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">DOLLARS</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token constant">CENTS</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">fn</span> <span class="token function-definition function">deposit</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> bytes<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Balance</span> <span class="token punctuation">{</span>
 items <span class="token keyword">as</span> <span class="token class-name">Balance</span> <span class="token operator">*</span> <span class="token number">15</span> <span class="token operator">*</span> <span class="token constant">CENTS</span> <span class="token operator">+</span> <span class="token punctuation">(</span>bytes <span class="token keyword">as</span> <span class="token class-name">Balance</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token constant">CENTS</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Assume ~10% of the block weight is consumed by `on_initialize` handlers.</span>
<span class="token comment">/// This is used to limit the maximal weight of a single extrinsic.</span>
<span class="token keyword">const</span> <span class="token constant">AVERAGE_ON_INITIALIZE_RATIO</span><span class="token punctuation">:</span> <span class="token class-name">Perbill</span> <span class="token operator">=</span> <span class="token class-name">Perbill</span><span class="token punctuation">::</span><span class="token function">from_percent</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*** End Added Block ***/</span>
</code></pre></li>
<li><p>Add the parameter types and implementation for the Config trait to the runtime.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token keyword">impl</span> <span class="token namespace">pallet_timestamp<span class="token punctuation">::</span></span><span class="token class-name">Config</span> <span class="token keyword">for</span> <span class="token class-name">Runtime</span> <span class="token punctuation">{</span>
<span class="token comment">/* --snip-- */</span>
<span class="token punctuation">}</span>

<span class="token comment">/*** Add this block ***/</span>
<span class="token macro property">parameter_types!</span> <span class="token punctuation">{</span>
 <span class="token keyword">pub</span> <span class="token class-name">TombstoneDeposit</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token function">deposit</span><span class="token punctuation">(</span>
     <span class="token number">1</span><span class="token punctuation">,</span>
     <span class="token operator">&lt;</span><span class="token namespace">pallet_contracts<span class="token punctuation">::</span></span><span class="token class-name">Pallet</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">>></span><span class="token punctuation">::</span><span class="token function">contract_info_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">pub</span> <span class="token class-name">DepositPerContract</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token class-name">TombstoneDeposit</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token class-name">DepositPerStorageByte</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token class-name">DepositPerStorageItem</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">pub</span> <span class="token class-name">RentFraction</span><span class="token punctuation">:</span> <span class="token class-name">Perbill</span> <span class="token operator">=</span> <span class="token class-name">Perbill</span><span class="token punctuation">::</span><span class="token function">from_rational</span><span class="token punctuation">(</span><span class="token number">1u32</span><span class="token punctuation">,</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token constant">DAYS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token class-name">SurchargeReward</span><span class="token punctuation">:</span> <span class="token class-name">Balance</span> <span class="token operator">=</span> <span class="token number">150</span> <span class="token operator">*</span> <span class="token constant">MILLICENTS</span><span class="token punctuation">;</span>
 <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token class-name">SignedClaimHandicap</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
 <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token class-name">MaxValueSize</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
 <span class="token comment">// The lazy deletion runs inside on_initialize.</span>
 <span class="token keyword">pub</span> <span class="token class-name">DeletionWeightLimit</span><span class="token punctuation">:</span> <span class="token class-name">Weight</span> <span class="token operator">=</span> <span class="token constant">AVERAGE_ON_INITIALIZE_RATIO</span> <span class="token operator">*</span>
  <span class="token class-name">BlockWeights</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max_block<span class="token punctuation">;</span>
 <span class="token comment">// The weight needed for decoding the queue should be less or equal than a fifth</span>
 <span class="token comment">// of the overall weight dedicated to the lazy deletion.</span>
 <span class="token keyword">pub</span> <span class="token class-name">DeletionQueueDepth</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DeletionWeightLimit</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>
     <span class="token operator">&lt;</span><span class="token class-name">Runtime</span> <span class="token keyword">as</span> <span class="token namespace">pallet_contracts<span class="token punctuation">::</span></span><span class="token class-name">Config</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token class-name">WeightInfo</span><span class="token punctuation">::</span><span class="token function">on_initialize_per_queue_item</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span>
     <span class="token operator">&lt;</span><span class="token class-name">Runtime</span> <span class="token keyword">as</span> <span class="token namespace">pallet_contracts<span class="token punctuation">::</span></span><span class="token class-name">Config</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token class-name">WeightInfo</span><span class="token punctuation">::</span><span class="token function">on_initialize_per_queue_item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>

 <span class="token keyword">pub</span> <span class="token class-name">Schedule</span><span class="token punctuation">:</span> <span class="token namespace">pallet_contracts<span class="token punctuation">::</span></span><span class="token class-name">Schedule</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token namespace">pallet_contracts<span class="token punctuation">::</span></span><span class="token class-name">Config</span> <span class="token keyword">for</span> <span class="token class-name">Runtime</span> <span class="token punctuation">{</span>
 <span class="token keyword">type</span> <span class="token class-name">Time</span> <span class="token operator">=</span> <span class="token class-name">Timestamp</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">Randomness</span> <span class="token operator">=</span> <span class="token class-name">RandomnessCollectiveFlip</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">Currency</span> <span class="token operator">=</span> <span class="token class-name">Balances</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">Event</span> <span class="token operator">=</span> <span class="token class-name">Event</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">RentPayment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">SignedClaimHandicap</span> <span class="token operator">=</span> <span class="token class-name">SignedClaimHandicap</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">TombstoneDeposit</span> <span class="token operator">=</span> <span class="token class-name">TombstoneDeposit</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">DepositPerContract</span> <span class="token operator">=</span> <span class="token class-name">DepositPerContract</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">DepositPerStorageByte</span> <span class="token operator">=</span> <span class="token class-name">DepositPerStorageByte</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">DepositPerStorageItem</span> <span class="token operator">=</span> <span class="token class-name">DepositPerStorageItem</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">RentFraction</span> <span class="token operator">=</span> <span class="token class-name">RentFraction</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">SurchargeReward</span> <span class="token operator">=</span> <span class="token class-name">SurchargeReward</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">WeightPrice</span> <span class="token operator">=</span> <span class="token namespace">pallet_transaction_payment<span class="token punctuation">::</span></span><span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">WeightInfo</span> <span class="token operator">=</span> <span class="token namespace">pallet_contracts<span class="token punctuation">::</span>weights<span class="token punctuation">::</span></span><span class="token class-name">SubstrateWeight</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">ChainExtension</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">DeletionQueueDepth</span> <span class="token operator">=</span> <span class="token class-name">DeletionQueueDepth</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">DeletionWeightLimit</span> <span class="token operator">=</span> <span class="token class-name">DeletionWeightLimit</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">Call</span> <span class="token operator">=</span> <span class="token class-name">Call</span><span class="token punctuation">;</span>
 <span class="token comment">/// The safest default is to allow no calls at all.</span>
 <span class="token comment">///</span>
 <span class="token comment">/// Runtimes should whitelist dispatchables that are allowed to be called from contracts</span>
 <span class="token comment">/// and make sure they are stable. Dispatchables exposed to contracts are not allowed to</span>
 <span class="token comment">/// change because that would break already deployed contracts. The `Call` structure itself</span>
 <span class="token comment">/// is not allowed to change the indices of existing pallets, too.</span>
 <span class="token keyword">type</span> <span class="token class-name">CallFilter</span> <span class="token operator">=</span> <span class="token class-name">Nothing</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">Schedule</span> <span class="token operator">=</span> <span class="token class-name">Schedule</span><span class="token punctuation">;</span>
 <span class="token keyword">type</span> <span class="token class-name">CallStack</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token namespace">pallet_contracts<span class="token punctuation">::</span></span><span class="token class-name">Frame</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*** End added block ***/</span>
</code></pre>
<p>For more information about the configuration of the Contracts pallet and how the types and parameters are use, see the <a href="https://github.com/paritytech/substrate/blob/master/frame/contracts/src/lib.rs">Contracts pallet source code</a>.</p></li>
<li><p>Identify the types that the Contracts pallet exposes.</p>
<p>You can find a complete list of types in the <a href="https://substrate.dev/rustdocs/latest/frame_support/macro.construct_runtime.html"><code>construct_runtime!</code> macro</a> documentation.</p>
<p>The <a href="https://github.com/paritytech/substrate/blob/master/frame/contracts/src/lib.rs">Contracts pallet</a> uses the following types:</p>
<ul>
<li><strong>Storage</strong> because it uses the <code>#[pallet::storage]</code> macro.</li>
<li><strong>Event</strong> because it uses the <code>#[pallet::event]</code> macro.</li>
<li><strong>Call</strong>able functions because it has dispatchable functions in the <code>#[pallet::call]</code> macro.</li>
<li><strong>Config</strong>uration values because of the types under the <code>#[pallet::config]</code> macro.</li>
<li>The <strong>Pallet</strong> type from the <code>#[frame_support::pallet]</code> macro.</li>
</ul></li>
<li><p>Add the types exposed in the Contracts pallet to the <code>construct_runtime!</code> macro.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token macro property">construct_runtime!</span><span class="token punctuation">(</span>
 <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Runtime</span> <span class="token keyword">where</span>
  <span class="token class-name">Block</span> <span class="token operator">=</span> <span class="token class-name">Block</span><span class="token punctuation">,</span>
  <span class="token class-name">NodeBlock</span> <span class="token operator">=</span> <span class="token namespace">opaque<span class="token punctuation">::</span></span><span class="token class-name">Block</span><span class="token punctuation">,</span>
  <span class="token class-name">UncheckedExtrinsic</span> <span class="token operator">=</span> <span class="token class-name">UncheckedExtrinsic</span>
 <span class="token punctuation">{</span>
  <span class="token comment">/* --snip-- */</span>
  <span class="token comment">/*** Add this ine ***/</span>
  <span class="token class-name">Contracts</span><span class="token punctuation">:</span> <span class="token namespace">pallet_contracts<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Pallet</span><span class="token punctuation">,</span> <span class="token class-name">Call</span><span class="token punctuation">,</span> <span class="token class-name">Storage</span><span class="token punctuation">,</span> <span class="token class-name">Event</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li><p>Save your changes and close the <code>runtime/src/lib.rs</code> file.</p></li>
<li><p>Check that your runtime compiles correctly by running the following command:</p>
<pre><code class="hljs css language-bash">cargo check -p node-template-runtime
</code></pre>
<p>Although the runtime should compile, you cannot yet compile the entire node.</p></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="expose-the-contracts-api"></a><a href="#expose-the-contracts-api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Expose the Contracts API</h2>
<p>Some pallets, including the Contracts pallet, expose custom runtime APIs and RPC endpoints. You are not required to enable the RPC calls on the Contracts pallet to use it on chain. However, it is useful to expose the APIs and endpoints for the Contracts pallet because doing so enables you to perform the following tasks:</p>
<ul>
<li><p>Read contracts state from off chain.</p></li>
<li><p>Make calls to node storage without making a transaction.</p></li>
</ul>
<p>To expose the Contracts RPC API:</p>
<ol>
<li><p>Open the <code>runtime/Cargo.toml</code> file in a text editor and add a dependencies section to import the Contracts RPC endpoints runtime API.</p>
<p>例如：</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies.pallet-contracts-rpc-runtime-api</span><span class="token punctuation">]</span>
<span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
<span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/paritytech/substrate.git'</span>
<span class="token key property">tag</span> <span class="token punctuation">=</span> <span class="token string">'monthly-YYYY-MM'</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">'4.0.0-dev'</span>
</code></pre>
<p>Recall that the <code>tag</code> you use must the same for all of the pallet crates you are importing. For example, if all of the other dependency use <code>tag = 'monthly-2021-09+1'</code>, replace <code>tag = 'monthly-YYYY-MM'</code> with <code>tag = 'monthly-2021-09+1'</code>.</p></li>
<li><p>Add the Contracts RPC API to the list of <code>std</code> features so that its features are included when the runtime is built as a native Rust binary.</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">features</span><span class="token punctuation">]</span>
<span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">'std'</span><span class="token punctuation">]</span>
<span class="token key property">std</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
 <span class="token comment">#--snip--</span>
 <span class="token string">'pallet-contracts-rpc-runtime-api/std'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></li>
<li><p>Save your changes and close the <code>runtime/Cargo.toml</code> file.</p></li>
<li><p>Open the <code>runtime/src/lib.rs</code> file and implement the contracts runtime API in the <code>impl_runtime_apis!</code> macro near the end of the runtime <code>lib.rs</code> file.</p>
<p>例如：</p>
<pre><code class="hljs css language-rust"><span class="token macro property">impl_runtime_apis!</span> <span class="token punctuation">{</span>
 <span class="token comment">/* --snip-- */</span>
 <span class="token comment">/*** Add this block ***/</span>
 <span class="token keyword">impl</span> <span class="token namespace">pallet_contracts_rpc_runtime_api<span class="token punctuation">::</span></span><span class="token class-name">ContractsApi</span><span class="token operator">&lt;</span><span class="token class-name">Block</span><span class="token punctuation">,</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">Balance</span><span class="token punctuation">,</span> <span class="token class-name">BlockNumber</span><span class="token punctuation">,</span> <span class="token class-name">Hash</span><span class="token operator">></span>
 <span class="token keyword">for</span> <span class="token class-name">Runtime</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">call</span><span class="token punctuation">(</span>
         origin<span class="token punctuation">:</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span>
         dest<span class="token punctuation">:</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span>
         value<span class="token punctuation">:</span> <span class="token class-name">Balance</span><span class="token punctuation">,</span>
         gas_limit<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
         input_data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">pallet_contracts_primitives<span class="token punctuation">::</span></span><span class="token class-name">ContractExecResult</span> <span class="token punctuation">{</span>
         <span class="token keyword">let</span> debug <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token class-name">Contracts</span><span class="token punctuation">::</span><span class="token function">bare_call</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> value<span class="token punctuation">,</span> gas_limit<span class="token punctuation">,</span> input_data<span class="token punctuation">,</span> debug<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

     <span class="token keyword">fn</span> <span class="token function-definition function">instantiate</span><span class="token punctuation">(</span>
         origin<span class="token punctuation">:</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span>
         endowment<span class="token punctuation">:</span> <span class="token class-name">Balance</span><span class="token punctuation">,</span>
         gas_limit<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
         code<span class="token punctuation">:</span> <span class="token namespace">pallet_contracts_primitives<span class="token punctuation">::</span></span><span class="token class-name">Code</span><span class="token operator">&lt;</span><span class="token class-name">Hash</span><span class="token operator">></span><span class="token punctuation">,</span>
         data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span>
         salt<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">pallet_contracts_primitives<span class="token punctuation">::</span></span><span class="token class-name">ContractInstantiateResult</span><span class="token operator">&lt;</span><span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">BlockNumber</span><span class="token operator">></span> <span class="token punctuation">{</span>
         <span class="token keyword">let</span> compute_rent_projection <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">let</span> debug <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token class-name">Contracts</span><span class="token punctuation">::</span><span class="token function">bare_instantiate</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> endowment<span class="token punctuation">,</span> gas_limit<span class="token punctuation">,</span> code<span class="token punctuation">,</span> data<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> compute_rent_projection<span class="token punctuation">,</span> debug<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">fn</span> <span class="token function-definition function">get_storage</span><span class="token punctuation">(</span>
         address<span class="token punctuation">:</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span>
         key<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">pallet_contracts_primitives<span class="token punctuation">::</span></span><span class="token class-name">GetStorageResult</span> <span class="token punctuation">{</span>
         <span class="token class-name">Contracts</span><span class="token punctuation">::</span><span class="token function">get_storage</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">fn</span> <span class="token function-definition function">rent_projection</span><span class="token punctuation">(</span>
         address<span class="token punctuation">:</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">pallet_contracts_primitives<span class="token punctuation">::</span></span><span class="token class-name">RentProjectionResult</span><span class="token operator">&lt;</span><span class="token class-name">BlockNumber</span><span class="token operator">></span> <span class="token punctuation">{</span>
         <span class="token class-name">Contracts</span><span class="token punctuation">::</span><span class="token function">rent_projection</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token comment">/*** End added block ***/</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li><p>Save your changes and close the <code>runtime/src/lib.rs</code> file.</p></li>
<li><p>Check that your runtime compiles correctly by running the following command:</p>
<pre><code class="hljs css language-bash">cargo check -p node-template-runtime
</code></pre></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="updating-the-outer-node"></a><a href="#updating-the-outer-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Updating the outer node</h2>
<p>At this point, you have finished adding the Contracts pallet to the runtime. Now, you need to consider whether the outer node requires any corresponding updates. For the Contracts pallet to take advantage of the RPC endpoint API, you need to add the custom RPC endpoint to the node configuration.</p>
<p>To add the RPC API extension to the outer node:</p>
<ol>
<li><p>Open the <code>node/Cargo.toml</code> file and add the dependencies sections to import the Contracts and Contracts RPC crates.</p>
<p>例如：</p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">jsonrpc-core</span> <span class="token punctuation">=</span> <span class="token string">'15.1.0'</span>
<span class="token key property">structopt</span> <span class="token punctuation">=</span> <span class="token string">'0.3.8'</span>
<span class="token comment">#--snip--</span>
<span class="token comment"># *** Add the following lines ***</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies.pallet-contracts</span><span class="token punctuation">]</span>
<span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/paritytech/substrate.git'</span>
<span class="token key property">tag</span> <span class="token punctuation">=</span> <span class="token string">'monthly-YYYY-MM'</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">'4.0.0-dev'</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies.pallet-contracts-rpc</span><span class="token punctuation">]</span>
<span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/paritytech/substrate.git'</span>
<span class="token key property">tag</span> <span class="token punctuation">=</span> <span class="token string">'monthly-YYYY-MM'</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">'4.0.0-dev'</span>
</code></pre>
<p>Because you have exposed the runtime API and are now working in code for the outer node, you don't need to use <code>no_std</code> configuration, so you don't have to maintain a dedicated <code>std</code> list of features.</p></li>
<li><p>Save your changes and close the <code>node/Cargo.toml</code> file.</p></li>
<li><p>Open the <code>node/src/rpc.rs</code> file in a text editor.</p>
<p>Substrate provides an RPC to interact with the node. However, it does not contain access to the Contracts pallet by default. To interact with the Contracts pallet, you must extend the existing RPC and add the Contracts pallet and its API.</p>
<pre><code class="hljs css language-rust"><span class="token keyword">use</span> <span class="token namespace">node_template_runtime<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">opaque<span class="token punctuation">::</span></span><span class="token class-name">Block</span><span class="token punctuation">,</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">Balance</span><span class="token punctuation">,</span> <span class="token class-name">Index</span><span class="token punctuation">,</span> <span class="token class-name">BlockNumber</span><span class="token punctuation">,</span> <span class="token class-name">Hash</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// NOTE THIS IS AN ADJUSTMENT TO AN EXISTING LINE</span>
<span class="token keyword">use</span> <span class="token namespace">pallet_contracts_rpc<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Contracts</span><span class="token punctuation">,</span> <span class="token class-name">ContractsApi</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token comment">/* --snip-- */</span>

<span class="token comment">/// Instantiate all full RPC extensions.</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">create_full</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token class-name">P</span><span class="token operator">></span><span class="token punctuation">(</span>
   deps<span class="token punctuation">:</span> <span class="token class-name">FullDeps</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token class-name">P</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">jsonrpc_core<span class="token punctuation">::</span></span><span class="token class-name">IoHandler</span><span class="token operator">&lt;</span><span class="token namespace">sc_rpc<span class="token punctuation">::</span></span><span class="token class-name">Metadata</span><span class="token operator">></span> <span class="token keyword">where</span>
   <span class="token comment">/* --snip-- */</span>
   <span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'static</span><span class="token punctuation">,</span>
   <span class="token class-name">C</span><span class="token punctuation">::</span><span class="token class-name">Api</span><span class="token punctuation">:</span> <span class="token namespace">substrate_frame_rpc_system<span class="token punctuation">::</span></span><span class="token class-name">AccountNonceApi</span><span class="token operator">&lt;</span><span class="token class-name">Block</span><span class="token punctuation">,</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">Index</span><span class="token operator">></span><span class="token punctuation">,</span>
   <span class="token comment">/*** Add This Line ***/</span>
   <span class="token class-name">C</span><span class="token punctuation">::</span><span class="token class-name">Api</span><span class="token punctuation">:</span> <span class="token namespace">pallet_contracts_rpc<span class="token punctuation">::</span></span><span class="token class-name">ContractsRuntimeApi</span><span class="token operator">&lt;</span><span class="token class-name">Block</span><span class="token punctuation">,</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span> <span class="token class-name">Balance</span><span class="token punctuation">,</span> <span class="token class-name">BlockNumber</span><span class="token punctuation">,</span> <span class="token class-name">Hash</span><span class="token operator">></span><span class="token punctuation">,</span>
   <span class="token comment">/* --snip-- */</span>
<span class="token punctuation">{</span>
   <span class="token comment">/* --snip-- */</span>
   io<span class="token punctuation">.</span><span class="token function">extend_with</span><span class="token punctuation">(</span>
     <span class="token class-name">TransactionPaymentApi</span><span class="token punctuation">::</span><span class="token function">to_delegate</span><span class="token punctuation">(</span><span class="token class-name">TransactionPayment</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">/*** Add this block ***/</span>
   <span class="token comment">// Contracts RPC API extension</span>
   io<span class="token punctuation">.</span><span class="token function">extend_with</span><span class="token punctuation">(</span>
     <span class="token class-name">ContractsApi</span><span class="token punctuation">::</span><span class="token function">to_delegate</span><span class="token punctuation">(</span><span class="token class-name">Contracts</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">/*** End added block ***/</span>
   io
<span class="token punctuation">}</span>
</code></pre></li>
<li><p>Save your changes and close the <code>node/src/rpc.rs</code> file.</p></li>
<li><p>Check that your runtime compiles correctly by running the following command:</p>
<pre><code class="hljs css language-bash">cargo check -p node-template-runtime
</code></pre></li>
</ol>
<p>If there are no errors, you are ready to compile.</p>
<ol>
<li><p>Compile the node in release mode by running the following command:</p>
<pre><code class="hljs css language-bash">cargo build --release
</code></pre></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="start-the-blockchain-node-and-use-the-contracts-pallet"></a><a href="#start-the-blockchain-node-and-use-the-contracts-pallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Start the blockchain node and use the Contracts pallet</h2>
<p>After your node compiles, you are ready to start the Substrate node that has been enhanced with smart contract capabilities from the <a href="https://substrate.dev/rustdocs/latest/pallet_contracts/index.html">Contracts pallet</a> and interact with it using the front-end template.</p>
<h3><a class="anchor" aria-hidden="true" id="start-the-local-substrate-node"></a><a href="#start-the-local-substrate-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Start the local Substrate node</h3>
<p>To start the local Substrate node:</p>
<ol>
<li><p>Open a terminal shell, if necessary.</p></li>
<li><p>Change to the root directory of the Substrate node template.</p></li>
<li><p>Start the node in development mode by running the following command:</p>
<pre><code class="hljs"><span class="token punctuation">.</span><span class="token operator">/</span>target<span class="token operator">/</span>release<span class="token operator">/</span>node<span class="token operator">-</span>template <span class="token operator">-</span><span class="token operator">-</span>dev <span class="token operator">-</span><span class="token operator">-</span>tmp
</code></pre>
<p>The node-template command-line options specify how you want the running node to operate. In this case, the options specify the following:</p>
<ul>
<li><p>The <code>--dev</code> option specifies that the node run as a developer node chain specification.</p></li>
<li><p>The <code>--tmp</code> option specifies that the node save all active data—such as keys, blockchain database, and networking information—while it is running, then delete the data when you stop the node by pressing Control-c. You should use <code>--tmp</code> option to ensure you have a clean working state any time you stop and restart the node.</p></li>
</ul></li>
<li><p>Verify your node is up and running successfully by reviewing the output displayed in the terminal.</p>
<p>If the number after <code>finalized</code> is increasing in the console output, your blockchain is producing new blocks and reaching consensus about the state they describe.</p></li>
<li><p>Keep the terminal that displays the node output open to continue.</p></li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="start-the-front-end-template"></a><a href="#start-the-front-end-template" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Start the front-end template</h3>
<p>The Substrate front-end template consists of user interface components to enable you to interact with the Substrate node and perform a few common tasks.</p>
<p>To use the front-end template:</p>
<ol>
<li><p>Open a new terminal shell on your computer.</p></li>
<li><p>In the new terminal, change to the root directory where you installed the front-end template.</p></li>
<li><p>Start the web server for the front-end template by running the following command:</p>
<pre><code class="hljs css language-bash">yarn start
</code></pre></li>
<li><p>Open <a href="http://localhost:8000/">http://localhost:8000/</a> in a browser to view the front-end template.</p></li>
<li><p>In the Pallet Interactor component, verify that Extrinsic is selected.</p></li>
<li><p>Select <code>contracts</code> from the list of pallets available to call.</p>
<p><img src="/docs/assets/tutorials/contracts-pallet.png" alt="View the contracts pallets"></p></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="next-steps"></a><a href="#next-steps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Next steps</h2>
<p>In this tutorial, you learned:</p>
<ul>
<li>How to import the Contracts pallet.</li>
<li>How to expose the Contracts pallet RPC endpoints API.</li>
<li>How to update the outer node.</li>
<li>How to verify the Contracts pallet is available in the runtime using the front-end template.</li>
</ul>
<p>To begin using the Contracts pallet, you'll need to start writing some smart contracts to deploy. To learn about writing and deploying smart contracts, see our <a href="../../knowledgebase/smart-contracts/">Substrate ink! smart contracts</a>.</p>
<p>If you are ready to explore additional pallets, see the <a href="https://github.com/paritytech/substrate/blob/master/bin/node/runtime">demonstration Substrate node runtime</a>. The demonstration runtime includes nearly every pallet available in the FRAME development environment.</p>
<p>For a basic guide to writing your own custom pallet, see the <a href="../../tutorials/build-a-dapp/pallet">Build a dApp</a> tutorial.</p>
<p>For a closer look at runtime APIs and RPC endpoints, see the documentation for <a href="https://substrate.dev/recipes/runtime-api.html">Runtime APIs</a> and <a href="https://substrate.dev/recipes/custom-rpc.html">Custom RPCs</a>.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#before-you-begin">Before you begin</a></li><li><a href="#file-structure">File structure</a></li><li><a href="#add-the-crate-for-the-contract-pallet-to-the-node-template">Add the crate for the Contract pallet to the node template</a></li><li><a href="#implement-the-contracts-configuration-trait">Implement the Contracts configuration trait</a></li><li><a href="#expose-the-contracts-api">Expose the Contracts API</a></li><li><a href="#updating-the-outer-node">Updating the outer node</a></li><li><a href="#start-the-blockchain-node-and-use-the-contracts-pallet">Start the blockchain node and use the Contracts pallet</a><ul class="toc-headings"><li><a href="#start-the-local-substrate-node">Start the local Substrate node</a></li><li><a href="#start-the-front-end-template">Start the front-end template</a></li></ul></li><li><a href="#next-steps">Next steps</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>开发者中心</h5><a href="/zh-CN/tutorials">教程</a><a href="/docs/zh-CN/">知识库</a><a href="https://substrate.dev/recipes/">进阶菜谱</a><a href="https://substrate.dev/substrate-how-to-guides">How-to Guides</a><a href="https://substrate.dev/rustdocs">API 文档</a><a href="https://playground.substrate.dev/">Playground</a></div><div><h5>社区</h5><a href="/zh-CN/community">社区主页</a><a href="/zh-CN/newsletter">通讯</a><a href="https://matrix.to/#/#substrate-technical:matrix.org">Substrate 技术聊天室</a><a href="/zh-CN/seminar">Substrate 研讨会</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/substrate_io" target="_blank" rel="noreferrer noopener">推特</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">聚会活动</a></div><div><h5>更多</h5><a href="https://www.substrate.io/builders-program/">Substrate Builders 计划</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">开发者中心 GitHub</a><a href="https://www.parity.io/privacy/">隐私政策</a><a href="/terms">使用条款</a><a href="#" id="cookie-settings">Cookie 设置<script>
                var cookieSettings = document.getElementById('cookie-settings');
                cookieSettings.onclick = function() {
                  return klaro.show();
                };
              </script></a></div></section><section class="copyright">Copyright © 2021 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>