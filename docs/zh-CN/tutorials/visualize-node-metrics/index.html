<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>可视化节点数据 · Substrate Developer Hub</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="最新版本的 Substrate 开放了指标，比如你节点连接了多少同伴节点，使用了多少内存，等等。 你可使用 [Prometheus](https://prometheus.io/) 和 [Grafana](https://grafana.com/) 这类的工具来可视化这些指标。"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="可视化节点数据 · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="最新版本的 Substrate 开放了指标，比如你节点连接了多少同伴节点，使用了多少内存，等等。 你可使用 [Prometheus](https://prometheus.io/) 和 [Grafana](https://grafana.com/) 这类的工具来可视化这些指标。"/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script><script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/past-seminars.js"></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/docs/zh-CN/" target="_self">知识库</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">进阶菜谱</a></li><li class=""><a href="https://substrate.dev/substrate-how-to-guides/" target="_self">How-to Guides</a></li><li class=""><a href="https://substrate.dev/rustdocs/" target="_self">Reference</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>简体中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/tutorials/visualize-node-metrics">English</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">协助翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">可视化节点数据</h1></header><article><div><span><p>最新版本的 Substrate 开放了指标，比如你节点连接了多少同伴节点，使用了多少内存，等等。 你可使用 <a href="https://prometheus.io/">Prometheus</a> 和 <a href="https://grafana.com/">Grafana</a> 这类的工具来可视化这些指标。</p>
<blockquote>
<p>注意：过去 Substrate 是直接开放了 Grafana JSON 的端点。 但是现在已经被 Prometheus 指标端点替代了。</p>
</blockquote>
<p>一个合理的架构大概是这样：</p>
<pre><code class="hljs"><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>                     <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>                                                              <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> <span class="token class-name">Substrate</span> <span class="token operator">|</span>                     <span class="token operator">|</span> <span class="token class-name">Prometheus</span>  <span class="token operator">|</span>                                                              <span class="token operator">|</span> <span class="token class-name">Grafana</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>                     <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>                                                              <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>
      <span class="token operator">|</span>               <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>\ <span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>               <span class="token operator">|</span> 每一分钟<span class="token operator">|</span><span class="token operator">-</span><span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>               <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">|</span> <span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>       获取当前指标值<span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span> `substrate_peers_count <span class="token number">5</span>`        <span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token punctuation">-></span><span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>\    <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">|</span>在本地数据库中保存指标值与相应的时间戳 <span class="token operator">|</span>    <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span> <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">|</span>    <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                         <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>\ <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                         <span class="token operator">|</span> 每次用户打开图表 <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                         <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">|</span> <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>       从 time<span class="token operator">-</span><span class="token class-name">X</span> 到 time<span class="token operator">-</span><span class="token class-name">Y</span> 中获取指标值 <span class="token lifetime-annotation symbol">'substrate_peers_count</span> ' <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                                                          <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span> `<span class="token function">substrate_peers_count</span> <span class="token punctuation">(</span><span class="token number">1582023828</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1582023847</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">...</span><span class="token punctuation">]</span>`           <span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token punctuation">-></span><span class="token operator">|</span>
      <span class="token operator">|</span>                                  <span class="token operator">|</span>                                                                          <span class="token operator">|</span>

</code></pre>
<p><details>
<summary>重新生成图表</summary></p>
<p>前往：<a href="https://textart.io/sequence">https://textart.io/sequence</a></p>
<pre><code class="hljs">object <span class="token class-name">Substrate</span> <span class="token class-name">Prometheus</span> <span class="token class-name">Grafana</span>
note left of <span class="token class-name">Prometheus</span><span class="token punctuation">:</span> <span class="token class-name">Every</span> <span class="token number">1</span> minute
<span class="token class-name">Prometheus</span><span class="token punctuation">-></span><span class="token class-name">Substrate</span><span class="token punctuation">:</span> <span class="token constant">GET</span> current metric values
<span class="token class-name">Substrate</span><span class="token punctuation">-></span><span class="token class-name">Prometheus</span><span class="token punctuation">:</span> `substrate_peers_count <span class="token number">5</span>`
note right of <span class="token class-name">Prometheus</span><span class="token punctuation">:</span> <span class="token class-name">Save</span> metric value with corresponding time stamp <span class="token keyword">in</span> local database
note left of <span class="token class-name">Grafana</span><span class="token punctuation">:</span> <span class="token class-name">Every</span> time user opens graphs
<span class="token class-name">Grafana</span><span class="token punctuation">-></span><span class="token class-name">Prometheus</span><span class="token punctuation">:</span> <span class="token constant">GET</span> values of metric `substrate_peers_count` from time<span class="token operator">-</span><span class="token class-name">X</span> to time<span class="token operator">-</span><span class="token class-name">Y</span>
<span class="token class-name">Prometheus</span><span class="token punctuation">-></span><span class="token class-name">Grafana</span><span class="token punctuation">:</span> `<span class="token function">substrate_peers_count</span> <span class="token punctuation">(</span><span class="token number">1582023828</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1582023847</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">...</span><span class="token punctuation">]</span>`
</code></pre>
<p></details></p>
<h2><a class="anchor" aria-hidden="true" id="安装-prometheus-和-grafana"></a><a href="#安装-prometheus-和-grafana" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装 Prometheus 和 Grafana</h2>
<ol>
<li><a href="https://prometheus.io/docs/prometheus/latest/installation/">安裝 Prometheus</a></li>
<li><a href="https://grafana.com/get">安裝 Grafana</a></li>
</ol>
<blockquote>
<p>注意：为了 <em>测试</em>，我们建议您直接下载已编译好的 <code>bin</code> 程序，而不是在本地作完整安装或在 Docker 里运行。 就 <code>下载</code> 适合你本地架构的版本，然后在 <code>工作目录</code> 里运行它。 上面的链接提供了相关指引，本指南也会假定你是这样做。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="start-a-substrate-template-node"></a><a href="#start-a-substrate-template-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Start a Substrate Template Node</h2>
<blockquote>
<p>Before you continue here, you should complete the <a href="/docs/zh-CN/tutorials/create-your-first-substrate-chain/">create your first substrate chain</a> tutorial. The same substrate version, conventions for directory structure, and bin names are used here. You can of course use your own custom substrate node instead of the template, just edit the commands shown as needed.</p>
</blockquote>
<p>Substrate 开放了端点让指标数据可以 <a href="https://prometheus.io/docs/concepts/data_model/">Prometheus 可读格式</a> 于端口 <code>9615</code> 被读取。 你可以使用 <code>--prometheus-port &lt;PORT&gt;</code> 來更改端口，而且允许它可在本地 <code>--prometheus-external</code> 以外访问到。</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># clear the dev database</span>
./target/release/node-template purge-chain --dev -y
<span class="hljs-comment"># start the template node  in dev &amp; tmp mode to experiment</span>
<span class="hljs-comment"># optionally add the `--prometheus-port &lt;PORT&gt;`</span>
<span class="hljs-comment"># or `--prometheus-external` flags</span>
./target/release/node-template --dev --tmp
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="配置-prometheus-去扫描你的-substrate-节点"></a><a href="#配置-prometheus-去扫描你的-substrate-节点" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置 Prometheus 去扫描你的 Substrate 节点</h2>
<p>在安装 Prometheus 的工作目录中，你会找到 <code>prometheus.yml</code> 的配置文件。 让我们修改 (或创建一个新的文件) 来配置 Prometheus，通过添加到目标数组来扫描开放的端点。 如果您是修改默认值，这里是要修改的地方：</p>
<pre><code class="hljs css language-yml"><span class="hljs-comment"># --snip--</span>

<span class="hljs-comment"># A scrape configuration containing exactly one endpoint to scrape:</span>
<span class="hljs-comment"># Here it's Prometheus itself.</span>
<span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">"substrate_node"</span>

    <span class="hljs-comment"># metrics_path defaults to '/metrics'</span>
    <span class="hljs-comment"># scheme defaults to 'http'.</span>

    <span class="hljs-comment"># Override the global default and scrape targets from this job every 5 seconds.</span>
    <span class="hljs-comment"># ** <span class="hljs-doctag">NOTE:</span> you want to have this *LESS THAN* the block time in order to ensure</span>
    <span class="hljs-comment"># ** that you have a data point for every block!</span>
    <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">5s</span>

    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> <span class="hljs-string">["localhost:9615"]</span>
</code></pre>
<blockquote>
<p><strong>NOTE:</strong> you want to have <code>scrape_interval</code> <em>less than</em> the block time in order to ensure that you have a data point for every block!</p>
</blockquote>
<p>配置完 prometheus.yml 文件后，现在可开启 Prometheus。 假定您是下载了二进制文件，那就 <code>cd</code> 到安装目录并运行：</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># specify a custom config file instead if you made one here:</span>
./prometheus --config.file prometheus.yml
</code></pre>
<p>保持这个进程一直运行着。</p>
<h2><a class="anchor" aria-hidden="true" id="检查所有-prometheus-指标"></a><a href="#检查所有-prometheus-指标" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检查所有 Prometheus 指标</h2>
<p>在一个新的终端中，我们可以对 prometheus 快速进行状态检查：</p>
<pre><code class="hljs css language-bash">curl localhost:9615/metrics
</code></pre>
<p>应该返回类似以下的信息：</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># HELP substrate_block_height Block height info of the chain</span>
<span class="hljs-comment"># TYPE substrate_block_height gauge</span>
substrate_block_height{status=<span class="hljs-string">"best"</span>} 7
substrate_block_height{status=<span class="hljs-string">"finalized"</span>} 4
<span class="hljs-comment"># HELP substrate_build_info A metric with a constant '1' value labeled by name, version</span>
<span class="hljs-comment"># TYPE substrate_build_info gauge</span>
substrate_build_info{name=<span class="hljs-string">"available-vacation-6791"</span>,version=<span class="hljs-string">"2.0.0-4d97032-x86_64-linux-gnu"</span>} 1
<span class="hljs-comment"># HELP substrate_database_cache_bytes RocksDB cache size in bytes</span>
<span class="hljs-comment"># TYPE substrate_database_cache_bytes gauge</span>
substrate_database_cache_bytes 0
<span class="hljs-comment"># HELP substrate_finality_grandpa_precommits_total Total number of GRANDPA precommits cast locally.</span>
<span class="hljs-comment"># TYPE substrate_finality_grandpa_precommits_total counter</span>
substrate_finality_grandpa_precommits_total 31
<span class="hljs-comment"># HELP substrate_finality_grandpa_prevotes_total Total number of GRANDPA prevotes cast locally.</span>
<span class="hljs-comment"># TYPE substrate_finality_grandpa_prevotes_total counter</span>
substrate_finality_grandpa_prevotes_total 31
<span class="hljs-comment">#</span>
<span class="hljs-comment"># --snip--</span>
<span class="hljs-comment">#</span>
</code></pre>
<p>或者，在浏览器中打开相同的 URL (<a href="http://localhost:9615/metrics">http://localhost:9615/metrics</a>) 来查看所有指标数据。</p>
<blockquote>
<p>NOTE: here you can see the <code>HELP</code> fields for each metric that is exposed for monitoring via grafana.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="使用-grafana-来观看-prometheus-指标"></a><a href="#使用-grafana-来观看-prometheus-指标" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 Grafana 来观看 Prometheus 指标</h2>
<p>Once you have Grafana running, navigate to it in a browser (<strong>the default is <a href="http://localhost:3000/">http://localhost:3000/</a></strong>). 登录 (默认用户 <code>admin</code> 和密码 <code>admin</code>)，并导航到 <a href="http://localhost:3000/datasources">数据源</a> 页面。</p>
<p>You then need to select a <code>Prometheus</code> data source type and specify where Grafana needs to look for it.</p>
<blockquote>
<p>Note: The Prometheus port Grafana needs is NOT the one you set in the <code>prometheus.yml</code> file (<a href="http://localhost:9615">http://localhost:9615</a>) for where your node is publishing it's data.</p>
</blockquote>
<p>With your substrate node and Prometheus are running, configure Grafana to look for Prometheus on it's default port: <a href="http://localhost:9090">http://localhost:9090</a> (unless you customized it).</p>
<p>Hit <code>Save &amp; Test</code> to ensure that you have the data source set correctly. Now you can configure a new dashboard!</p>
<h3><a class="anchor" aria-hidden="true" id="grafana-仪版表模板"></a><a href="#grafana-仪版表模板" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Grafana 仪版表模板</h3>
<p>If you would like a basic dashboard to start <a href="/docs/assets/tutorials/visualize-node-metrics/Substrate-Node-Template-Metrics.json">here is a template example</a> that you can <code>Import</code> in Grafana to get basic information about your node:</p>
<p><br></p>
<p><center>
<img src="/docs/assets/tutorials/visualize-node-metrics/grafana.png" alt="grafana dashboard" width="50%" />
</center>
<br></p>
<p>If you create your own, the <a href="https://prometheus.io/docs/visualization/grafana/">prometheus docs for grafana</a> may be helpful.</p>
<p><b>If you do create one, consider uploading it to the
<a href="https://grafana.com/grafana/dashboards">community list of dashboards</a> and letting
the substrate builder community know it exists by listing in on
<a href="https://github.com/substrate-developer-hub/awesome-substrate">Awesome Substrate</a>!
Here is ours on <a href="https://grafana.com/grafana/dashboards/13759/">the grafana public dashboards</a></b></p>
<h2><a class="anchor" aria-hidden="true" id="后续步骤"></a><a href="#后续步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续步骤</h2>
<h3><a class="anchor" aria-hidden="true" id="进一步学习"></a><a href="#进一步学习" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进一步学习</h3>
<ul>
<li>学习如何 <a href="../../tutorials/start-a-private-network/">创建 Substrate 私有网络</a>。</li>
<li>Further configuration, notification services, and permanent installation of <a href="https://wiki.polkadot.network/docs/maintain-guides-how-to-monitor-your-node">Substrate/Polkadot monitoring tools</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="例子"></a><a href="#例子" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>例子</h3>
<ul>
<li>查看 <a href="https://github.com/w3f/polkadot-dashboard">波卡网络</a> 的 Grafana 仪表版配置。</li>
<li><a href="https://grafana.com/grafana/dashboards/13759/">Grafana Template</a> for a Substrate Node Template</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="参考文档"></a><a href="#参考文档" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参考文档</h3>
<!-- TODO: Update this to RUSTDOC link-->
<ul>
<li>访问 <a href="https://github.com/paritytech/substrate/tree/master/utils/prometheus">Substrate Prometheus Exporter</a> 源码。</li>
<li>See the <a href="https://substrate.dev/rustdocs/latest/prometheus/index.html">docs for prometheus in substrate</a>.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#安装-prometheus-和-grafana">安装 Prometheus 和 Grafana</a></li><li><a href="#start-a-substrate-template-node">Start a Substrate Template Node</a></li><li><a href="#配置-prometheus-去扫描你的-substrate-节点">配置 Prometheus 去扫描你的 Substrate 节点</a></li><li><a href="#检查所有-prometheus-指标">检查所有 Prometheus 指标</a></li><li><a href="#使用-grafana-来观看-prometheus-指标">使用 Grafana 来观看 Prometheus 指标</a><ul class="toc-headings"><li><a href="#grafana-仪版表模板">Grafana 仪版表模板</a></li></ul></li><li><a href="#后续步骤">后续步骤</a><ul class="toc-headings"><li><a href="#进一步学习">进一步学习</a></li><li><a href="#例子">例子</a></li><li><a href="#参考文档">参考文档</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>开发者中心</h5><a href="/zh-CN/tutorials">教程</a><a href="/docs/zh-CN/">知识库</a><a href="https://substrate.dev/recipes/">进阶菜谱</a><a href="https://substrate.dev/substrate-how-to-guides">How-to Guides</a><a href="https://substrate.dev/rustdocs">API 文档</a><a href="https://playground.substrate.dev/">Playground</a></div><div><h5>社区</h5><a href="/zh-CN/community">社区主页</a><a href="/zh-CN/newsletter">通讯</a><a href="https://matrix.to/#/#substrate-technical:matrix.org">Substrate 技术聊天室</a><a href="/zh-CN/seminar">Substrate 研讨会</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/substrate_io" target="_blank" rel="noreferrer noopener">推特</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">聚会活动</a></div><div><h5>更多</h5><a href="https://www.substrate.io/builders-program/">Substrate Builders 计划</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">开发者中心 GitHub</a><a href="https://www.parity.io/privacy/">隐私政策</a><a href="/terms">使用条款</a><a href="#" id="cookie-settings">Cookie 设置<script>
                var cookieSettings = document.getElementById('cookie-settings');
                cookieSettings.onclick = function() {
                  return klaro.show();
                };
              </script></a></div></section><section class="copyright">Copyright © 2021 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>